<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite" 
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core" 
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

    <composite:interface />

    <composite:implementation>
    	<div id="disable-interaction-overlay" style="display: none; position: fixed; top:0px; left: 0px; right: 0px; bottom: 0px; z-index: 999; background-color: rgba(230, 230, 230, 0.7);"></div>
        <h:form id="treeform">
            <h:inputText id="hiddenwidth" value="#{Metadaten.treeWidth}" style="display:none;" />

            <!-- METSEDITOR STRUCTURE ACTIONS -->
            <div id="structureActions" class="module module__structure-actions">
                <ul>
                    <li>
                        <h:commandLink id="hiddenwidthbutton" action="#{NavigationForm.Reload}" style="display:none;">
                            <i class="fa fa-floppy-o" />
                        </h:commandLink>
                    </li>
                    <li>
                        <!-- Verlinkung des Bildes mit dem gewaehlten Strukturelement -->
                        <h:commandLink 
                            id="linkImage"
                            pt:aria-label="#{msgs.verlinkungDesBildesMitStrukturelement}"
                            action="#{Metadaten.BildBlaettern}"
                            title="#{msgs.verlinkungDesBildesMitStrukturelement}"
                            styleClass="#{Metadaten.bildZuStrukturelement ? 'active' : ''}"
                            rel="tooltip">
                            <i class="#{Metadaten.bildZuStrukturelement ? 'fa fa-chain' : 'fa fa-chain-broken'}" aria-hidden="true"></i>
                            <x:updateActionListener value="0" property="#{Metadaten.numberOfNavigation}" />
                            <f:passThroughAttribute name="data-toggle" value="tooltip" />
                            <f:setPropertyActionListener 
                                target="#{Metadaten.bildZuStrukturelement}"
                                value="#{not Metadaten.bildZuStrukturelement}" />
                            <!-- 
                            <f:ajax 
                                execute="@form" 
                                render="@form :openseadragonform" />
                             -->
                            <f:passThroughAttribute name="data-renderimage" value="true" />
                        </h:commandLink>            
                    </li>
                    <li>
                        <h:commandLink 
                            id="showtitle"
                            pt:aria-label="#{msgs.mets_treeTitle}"
                            action="#{NavigationForm.Reload}" 
                            rel="tooltip"
                            styleClass="#{Metadaten.treeProperties.showtitle ? 'active' : ''}"
                            title="#{Metadaten.treeProperties.showtitle?msgs.mets_treeTitle_hide:msgs.mets_treeTitle}">
                            <i class="fa fa-list" aria-hidden="true"></i>
                            <f:passThroughAttribute name="data-toggle" value="tooltip" />
                            <x:updateActionListener 
                                value="#{Metadaten.treeProperties.showtitle?false:true}"
                                property="#{Metadaten.treeProperties.showtitle}" />
                                <f:ajax render="@form"/>
                        </h:commandLink>            
                    </li>
                    <li>
                        <h:commandLink id="showfirstpagenumber" 
                            pt:aria-label="#{msgs.mets_treePageNumber}"
                            action="#{NavigationForm.Reload}"
                            rel="tooltip"
                            styleClass="#{Metadaten.treeProperties.showfirstpagenumber ? 'active' : ''}"
                            title="#{Metadaten.treeProperties.showfirstpagenumber?msgs.mets_treePageNumber_hide:msgs.mets_treePageNumber}">
                            <i class="fa fa-exchange" aria-hidden="true"></i>
                            <f:passThroughAttribute name="data-toggle" value="tooltip" />
                            <x:updateActionListener 
                                value="#{Metadaten.treeProperties.showfirstpagenumber?false:true}"
                                property="#{Metadaten.treeProperties.showfirstpagenumber}" />
                            <f:ajax render="@form"/>
                        </h:commandLink>            
                    </li>
                    <li>
                    	<h:commandLink 
                            id="printpage2" 
                            pt:aria-label="#{msgs.process_generateSimplifiedMetadata}"
                            action="#{Metadaten.myProzess.downloadSimplifiedMetadataAsPDF}"  
                            title="#{msgs.process_generateSimplifiedMetadata}">
                            <i class="fa fa-print" aria-hidden="true"></i>
                            <f:passThroughAttribute name="data-toggle" value="tooltip" />
                        </h:commandLink>     
                    </li>
                </ul>
            </div>

            <!-- METSEDITOR STRUCTURE -->
            <div class="table__structure">
                <x:dataTable id="meStructure" forceId="true" value="#{Metadaten.strukturBaum3}" var="item" rowStyleClass="level-#{item.niveau}">
                    <h:column>
                        <h:commandLink 
                            id="expand" 
                            action="#{NavigationForm.Reload}"
                            class="#{item.node.expanded ? 'expand' : 'expanded'}"
                            rendered="#{item.node.hasChildren}">
                            <i class="#{item.node.expanded ? 'fa fa-caret-down fa-lg' : 'fa fa-caret-right fa-lg'}" />
                            <x:updateActionListener property="#{item.node.expanded}" value="#{not item.node.expanded}" />
                            <f:ajax execute="treeform" render="treeform" />
                        </h:commandLink>

                        <ui:fragment rendered="#{Metadaten.treeProperties.showMetadataPopup}">
                            <h:commandLink 
                                id="link" 
                                immediate="true"
                                styleClass="#{item.node.selected ? 'table__structure-link-active' : 'table__structure-link'}"
                                action="#{Metadaten.loadRightFrame}">
                                <i class="fa fa-file-o" aria-hidden="true"></i>

                                <h:outputText styleClass="item-niveau" value="#{item.niveau}" rendered="#{Metadaten.treeProperties.showtreelevel}" />
                                <f:passThroughAttribute name="data-trigger" value="hover" />
                                <f:passThroughAttribute name="data-container" value="#treeform" />
                                <f:passThroughAttribute name="data-toggle" value="popover" />
                                <f:passThroughAttribute name="data-placement" value="top" />
                                <f:passThroughAttribute name="data-html" value="true" />
                                <f:passThroughAttribute name="data-content" value="#{item.node.metadataPopup}" />
                                
                                <h:outputText value="#{item.node.description}"
                                    rendered="#{not Metadaten.treeProperties.showtitle or (Metadaten.treeProperties.showtitle and item.node.mainTitle == '')}" />
                                <h:outputText value="#{item.node.mainTitle}"
                                    rendered="#{item.node.mainTitle != '' and Metadaten.treeProperties.showtitle}" />
                                <h:outputText styleClass="page-info" value=" (#{item.node.firstImage}" rendered="#{Metadaten.treeProperties.showfirstpagenumber and item.node.firstImage!=''}" />
                                <h:outputText styleClass="page-info" value="-#{item.node.lastImage})" rendered="#{Metadaten.treeProperties.showfirstpagenumber and item.node.lastImage!=''}" />
                                <x:updateActionListener property="#{Metadaten.myStrukturelement}"
                                    value="#{item.node.struct}" />
                                <f:ajax execute="@form"
                                    render="@form #{Metadaten.bildZuStrukturelement ? ':openseadragonform :thumbnailsForm' : ''} :structureform :metadataform" />
                                <f:passThroughAttribute name="data-renderimage" value="#{Metadaten.bildZuStrukturelement ? 'true':'false'}" />
                            </h:commandLink>
                        </ui:fragment>

                        <ui:fragment rendered="#{!Metadaten.treeProperties.showMetadataPopup}">
                            <h:commandLink 
                                id="link2" 
                                immediate="true"
                                styleClass="#{item.node.selected ? 'table__structure-link-active' : 'table__structure-link'}"
                                action="#{Metadaten.loadRightFrame}">
                                <i class="fa fa-file-o" aria-hidden="true"></i>

                                 <h:outputText styleClass="item-niveau" value="#{item.niveau}" rendered="#{Metadaten.treeProperties.showtreelevel}" />
                                <h:outputText value="#{item.node.description}"
                                    rendered="#{not Metadaten.treeProperties.showtitle or (Metadaten.treeProperties.showtitle and item.node.mainTitle == '')}" />
                                <h:outputText value="#{item.node.mainTitle}"
                                    rendered="#{item.node.mainTitle != '' and Metadaten.treeProperties.showtitle}" />
                                <h:outputText styleClass="page-info" value=" (#{item.node.firstImage}" rendered="#{Metadaten.treeProperties.showfirstpagenumber and item.node.firstImage!=''}" />
                                <h:outputText styleClass="page-info" value="-#{item.node.lastImage})" rendered="#{Metadaten.treeProperties.showfirstpagenumber and item.node.lastImage!=''}" />
                                <x:updateActionListener property="#{Metadaten.myStrukturelement}"
                                    value="#{item.node.struct}" />
                                <f:ajax execute="@form"
                                    render="@form #{Metadaten.bildZuStrukturelement ? ':openseadragonform :thumbnailsForm' : ''} :structureform :metadataform" />
                                <f:passThroughAttribute name="data-renderimage" value="#{Metadaten.bildZuStrukturelement ? 'true':'false'}" />
                            </h:commandLink>
                        </ui:fragment>

                    </h:column>
                </x:dataTable>
            </div>
        </h:form>

        <h:form id="formWarn" style="display:none">
            <h:inputHidden id="Warnmeldung" value="#{msgs.esGibtUngespeicherteDaten}" />
        </h:form>
    </composite:implementation>
</ui:composition>