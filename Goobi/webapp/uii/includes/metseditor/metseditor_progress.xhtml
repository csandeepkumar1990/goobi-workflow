<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite" 
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core" 
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:p="http://primefaces.org/ui">

    <composite:interface />

    <composite:implementation>
        <h:form
            id="progressform"
            prependId="false">
            <!-- Modal -->
            <div
                class="modal fade"
                id="unsavedChanges"
                tabindex="-1"
                role="dialog"
                aria-labelledby="myModalLabel">
                <div
                    class="modal-dialog"
                    role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <a
                                href="#"
                                class="btn btn-blue pull-right"
                                title="#{msgs.cancel}"
                                data-dismiss="modal">
                                <i class="fa fa-times"></i>
                            </a>

                            <h4
                                class="modal-title"
                                id="myModalLabel">
                                <h:outputText value="#{msgs.metseditorFinish}" />
                            </h4>
                        </div>
                        <div class="modal-body">
                            <h:outputText value="#{msgs.metseditorSaveExplanation}" />
                        </div>
                        <div class="modal-footer">

                            <h:commandLink
                                id="discard"
                                styleClass="btn btn-lightred pull-left"
                                action="#{Metadaten.discard}"
                                title="#{msgs.discard}">
                                <i class="fa fa-trash-o margin-right-5"></i>
                                <h:outputText value="#{msgs.discard}" />
                            </h:commandLink>

                            <h:commandLink
                                id="overwrite"
                                styleClass="btn btn-green"
                                action="#{Metadaten.XMLschreiben}"
                                onclick="displayProgressBar()"
                                title="#{msgs.overwrite}">
                                <i class="fa fa-floppy-o margin-right-5"></i>
                                <h:outputText value="#{msgs.overwrite}" />
                            </h:commandLink>
                        </div>
                    </div>
                </div>
            </div>

            <h:panelGroup
                style="display: none"
                id="progressPanel"
                styleClass="metseditor_progress-panel">
                <p:commandButton
                    value="Start"
                    onclick="PF('pbAjax').start();"
                    type="button"
                    widgetVar="startButton2"
                    id="progressbutton"
                    style="display: none;" />

                <p:progressBar
                    widgetVar="pbAjax"
                    ajax="true"
                    value="#{Metadaten.progress}"
                    labelTemplate="{value}%"
                    styleClass="animated"
                    global="false">
                    <p:ajax
                        event="complete"
                        listener="#{Metadaten.onComplete}" />
                </p:progressBar>
            </h:panelGroup>

            <script type="text/javascript">
				function displayProgressBar() {
                    var element = document.getElementById('progressPanel');
                    if (element.style.display == 'block') {
                        element.style.display = 'none';
                    } else {
                        element.style.display = 'block';
                    }
                    document.getElementById('progressbutton').click();
                }

                function start() {
                    window['progress'] = setInterval( function () {
                        var pbClient = PF('pbClient'), oldValue = pbClient.getValue(), newValue = oldValue + 10;

                        pbClient.setValue(pbClient.getValue() + 10);

                        if (newValue === 100) {
                            clearInterval(window['progress']);
                        }
                    }, 1000);
                }
             </script>
        </h:form>

    </composite:implementation>
</ui:composition>