<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml" 
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite" 
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core" 
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites" 
    xmlns:p="http://primefaces.org/ui">

    <composite:interface />

    <composite:implementation>
        <div id="meEditGroupBox" class="module module__box module__box--gray module__box--collapsable">
            <div class="module__box-title">
                <h3>
                    <i class="fa fa-bars" aria-hidden="true"></i>
                    <span>#{msgs.metadataGroups}</span>
                    <button type="button" class="btn btn--clean" data-toggle="box-body">
                        <i class="fa fa-angle-up fa-lg" aria-hidden="true"></i>
                    </button>
                </h3>
            </div>
            <div class="module__box-body">
                <h:outputText value="#{msgs.mets_no_metadatagroups_assigned}" rendered="#{empty Metadaten.groups}" />

                <x:dataList 
                    id="groupList" 
                    var="Item" 
                    value="#{Metadaten.groups}" 
                    rowCountVar="rowCount" 
                    rowIndexVar="rowIndex">
                    <h5>
                        <h:outputText value="#{Item.name}" />
                    </h5>

                    <div class="row">
                        <div class="col-11">
                            <x:dataList 
                                id="grpMdList" 
                                var="metadata" 
                                value="#{Item.metadataList}" 
                                rowCountVar="varCount"
                                rowIndexVar="varIndex">
                                <intranda:formGroupMetadata 
                                    id="grpMetadata" 
                                    metadata="#{metadata}"
                                    renderDelete="false" 
                                    renderDuplicate="false" 
                                    datatype="group-metadata" 
                                    groupindex="#{varIndex}"
                                    index="#{rowIndex}" />
                            </x:dataList>            
            
                            <x:dataList 
                                id="grpPL" 
                                var="currentPerson" 
                                value="#{Item.personList}" 
                                rowCountVar="varCount"
                                rowIndexVar="varIndex">
                                <intranda:formGroupPerson 
                                    id="grpPerson" 
                                    person="#{currentPerson}"
                                    renderDelete="false" 
                                    datatype="group-person" 
                                    groupindex="#{varIndex}" 
                                    index="#{rowIndex}" />
                            </x:dataList>            
                        </div>

                        <div class="col-1">
                            <h:commandLink 
                                id="grpduplicate"
                                styleClass="btn btn--icon" 
                                action="#{Metadaten.CopyGroup}" 
                                title="#{msgs.metadatenKopieren}"
                                role="button">
                                <i class="fa fa-copy" aria-hidden="true"></i>
                                <x:updateActionListener property="#{Metadaten.currentGroup}" value="#{Item}" />
                                <f:param name="ID" value="#{cc.attrs.metadata.identifier}" />
                                <f:ajax execute="@form" render="@form" />
                            </h:commandLink>
                            <h:commandLink 
                                id="grpdelete" 
                                styleClass="btn btn--icon" 
                                action="#{Metadaten.deleteGroup}" 
                                title="#{msgs.metadatenLoeschen}"
                                role="button">
                                <i class="fa fa-trash-o" aria-hidden="true"></i>
                                <x:updateActionListener property="#{Metadaten.currentGroup}" value="#{Item}" />
                                <f:param name="ID" value="#{cc.attrs.metadata.identifier}" />
                                <f:ajax execute="@form" render="@form" />
                            </h:commandLink>
                        </div>
                    </div>            
                </x:dataList>            
            
                <h:panelGroup rendered="#{Metadaten.sizeOfMetadataGroups!=0}">
                    <hr />

                    <div class="row">
                        <div class="col-auto mr-auto"></div>
                        <div class="col-auto">
                            <h:commandLink 
                                id="addGroup" 
                                styleClass="btn btn--gray" 
                                value="#{msgs.AddNewGroup}"
                                action="#{Metadaten.AddGroup}"
                                role="button" />
                        </div>
                    </div>
                </h:panelGroup>
            </div>
        </div>
    </composite:implementation>
</ui:composition>