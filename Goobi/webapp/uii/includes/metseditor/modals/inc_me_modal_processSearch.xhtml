<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

    <composite:interface>
    </composite:interface>

    <composite:implementation>
     
            <!-- process search modal #processesSearchBox -->
            <style>
.searchgroup-container {
    border: 1px solid #ddd;
    margin-bottom: 5px;
    padding: 25px 10px 10px 10px;
}

.new-filter-btn {
    display: block;
    text-align: right;
    margin-top: 7px;
}

.filter-row {
    float: left;
    margin-top: 3px;
    width: calc(100% - 42px);
}

.controls-row {
    margin-top: 12px;
}

.group-conjunction td {
    padding: 3px;
}

.group-conjunction input[type="radio"] {
    margin: -3px 5px 0 0;
    vertical-align: middle;
}

.group-conjunction table {
    margin-top: 5px;
}

.modal-xxl {
    width: 90vw;
    height: 90vh;
}

.modal-xxl .modal-content {
    height: 100%;
}

.modal-xxl .modal-body {
    height: calc(100% - 57px);
    overflow-y: auto; 
}

.shrink {
    float: left;
    width: 16px;
    margin-top: 9px;
}



</style>
            <div
                class="modal fade"
                id="processesSearchBox"
                tabindex="-1"
                role="dialog"
                aria-labelledby="myModalLabel">
                <div
                    class="modal-dialog modal-xxl"
                    role="document">
                    <h:panelGroup
                        layout="block"
                        styleClass="modal-content"
                        id="processModalContent">
                        <div class="modal-header">
                            <a
                                href="#"
                                class="btn btn-blue pull-right"
                                title="#{msgs.cancel}"
                                data-dismiss="modal">
                                <i class="fa fa-times"></i>
                            </a>

                            <h4
                                class="modal-title"
                                id="myModalLabel">
                                <h:outputText value="#{msgs.NORM_processesSearch}" />
                            </h4>
                        </div>
                        <div class="modal-body">

                            <h:outputText
                                value="#{msgs.NORM_helpProcessesSearch}"
                                escape="false" />

                            <br />



                            <h:panelGroup
                                layout="block"
                                id="processes_search"
                                styleClass="row"
                                style="margin-top: 15px;">
                                <div class="col-sm-12">
                                    <c:if test="#{Metadaten.currentPlugin.title == 'ProcessPlugin'}">
                                        <ui:repeat
                                            value="#{Metadaten.currentPlugin.searchRequest.metadataFilters}"
                                            var="group"
                                            varStatus="globStatus">
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <div class="searchgroup-container clearfloat">
                                                        <h:commandLink
                                                            action="#{Metadaten.currentPlugin.searchRequest.deleteSearchGroup(globStatus.index)}"
                                                            styleClass="fa fa-times"
                                                            style="position:absolute; top:5px; right:21px;">
                                                            <f:ajax
                                                                execute=":normdataForm:processes_search"
                                                                render=":normdataForm:processes_search" />
                                                        </h:commandLink>
                                                        <ui:repeat
                                                            var="filter"
                                                            value="#{group.filters}"
                                                            varStatus="status">
                                                            <div class="row">
                                                                <div class="filter-row">
                                                                    <div class="col-sm-2 control-label">
                                                                        <h:selectOneMenu
                                                                            value="#{filter.field}"
                                                                            styleClass="form-control">
                                                                            <f:selectItems value="#{Metadaten.currentPlugin.possibleFields}" var="field" itemValue="#{field}" itemLabel="#{msgs[field]}"/>
                                                                        </h:selectOneMenu>
                                                                    </div>
                                                                    <div class="col-sm-1 control-label">
                                                                        <h:selectOneMenu
                                                                            value="#{filter.relation}"
                                                                            styleClass="form-control">
                                                                            <f:selectItems value="#{filter.operators}" />
                                                                        </h:selectOneMenu>
                                                                    </div>
                                                                    <div class="col-sm-9">
                                                                        <!--                                                                    search button? -->
                                                                        <x:inputText
                                                                            value="#{filter.value}"
                                                                            styleClass="form-control input"
                                                                            id="input_processes" />
                                                                    </div>
                                                                </div>
                                                                <div class="shrink">
                                                                    <h:commandLink
                                                                        action="#{group.deleteFilter(status.index)}"
                                                                        styleClass="fa fa-trash pull-right">
                                                                        <f:ajax
                                                                            execute=":normdataForm:processes_search"
                                                                            render=":normdataForm:processes_search" />
                                                                    </h:commandLink>
                                                                </div>

                                                                <div class="clearfix"></div>
                                                            </div>
                                                        </ui:repeat>
                                                        <div class="row">
                                                            <div class="controls-row">
                                                                <h:panelGroup
                                                                    styleClass="group-conjunction"
                                                                    rendered="#{group.numFilters gt 1}">
                                                                    <div
                                                                        class="col-sm-8"
                                                                        style="padding-top: 4px;">
                                                                        <strong>
                                                                            <h:outputText value="#{msgs.NORM_filterconjunction}:" />
                                                                        </strong>
                                                                        <h:selectOneRadio value="#{group.conjunctive}">
                                                                            <f:selectItem
                                                                                itemValue="true"
                                                                                itemLabel="#{msgs.NORM_conjunctive}" />
                                                                            <f:selectItem
                                                                                itemValue="false"
                                                                                itemLabel="#{msgs.NORM_disjunctive}" />
                                                                            <f:ajax />
                                                                        </h:selectOneRadio>
                                                                    </div>
                                                                </h:panelGroup>
                                                                <div class="#{group.numFilters gt 1 ? 'col-sm-4' : 'col-sm-12'}">
                                                                    <div class="new-filter-btn">
                                                                        <h:commandLink action="#{group.newFilter}">
                                                                            <f:ajax
                                                                                execute=":normdataForm:processes_search"
                                                                                render=":normdataForm:processes_search" />
                                                                        #{msgs.NORM_newFilter}
                                                                    </h:commandLink>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </ui:repeat>
                                        <div class="row">
                                            <div class="controls-row">
                                                <h:panelGroup
                                                    styleClass="group-conjunction"
                                                    rendered="#{Metadaten.currentPlugin.searchRequest.numGroups gt 1}">
                                                    <div
                                                        class="col-sm-8"
                                                        style="padding-top: 4px;">
                                                        <strong>
                                                            <h:outputText value="#{msgs.NORM_groupconjunction}:" />
                                                        </strong>
                                                        <h:selectOneRadio value="#{Metadaten.currentPlugin.searchRequest.metadataConjunctive}">
                                                            <f:selectItem
                                                                itemValue="true"
                                                                itemLabel="#{msgs.NORM_conjunctive}" />
                                                            <f:selectItem
                                                                itemValue="false"
                                                                itemLabel="#{msgs.NORM_disjunctive}" />
                                                            <f:ajax />
                                                        </h:selectOneRadio>
                                                    </div>
                                                </h:panelGroup>
                                                <div class="#{Metadaten.currentPlugin.searchRequest.numGroups gt 1 ? 'col-sm-4' : 'col-sm-12'}">
                                                    <div class="new-filter-btn">
                                                        <h:commandLink action="#{Metadaten.currentPlugin.searchRequest.newGroup}">
                                                            <f:ajax
                                                                execute=":normdataForm:processes_search"
                                                                render=":normdataForm:processes_search" />
                                                        #{msgs.NORM_newGroup}
                                                    </h:commandLink>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </c:if>
                                </div>



                                <h:commandLink
                                    styleClass="btn btn-grey pull-right margin-right-10 margin-top-10 margin-bottom-10"
                                    action="#{Metadaten.currentPlugin.search}"
                                    title="#{msgs.search}">
                                    <i class="fa fa-search margin-right-5"></i>
                                    <h:outputText value="#{msgs.search}" />
                                    <f:ajax
                                        execute="@form"
                                        render="processResults" />
                                </h:commandLink>

                                <script>
                                    $('input[id*="geonamesSearch"]' ).on('focus',function() {
                                        $(this ).on('keyup',function(event ) {
                                            event.preventDefault();
                                            if ( event.keyCode == 13 ) {
                                                $(this ).parent().next().click();
                                            }
                                        } );
                                    } );
                                </script>

                            </h:panelGroup>

                            <h:panelGroup
                                id="processResults"
                                rendered="#{Metadaten.currentPlugin.title == 'ProcessPlugin'}">
                                <h:panelGroup
                                    id="processesList"
                                    layout="block"
                                    styleClass="row pre-scrollable"
                                    rendered="#{not empty Metadaten.currentPlugin.results}">
                                    <h:message
                                        for="processesList"
                                        showDetail="true"
                                        styleClass="help-inline font-danger" />

                                    <div class="col-sm-12">
                                        <h:dataTable
                                            value="#{Metadaten.currentPlugin.results}"
                                            var="process"
                                            styleClass="table table-hover table-nomargin dataTable table-bordered responsive">
                                            <c:if test="#{Metadaten.currentPlugin.title == 'ProcessPlugin'}">
                                                <c:forEach
                                                    items="#{Metadaten.currentPlugin.searchRequest.wantedFields}"
                                                    var="val">
                                                    <h:column>
                                                        <f:facet name="header">
                                                            <!-- TODO: translation ? -->
                                                            <h:outputText value="#{msgs[val]}" />
                                                        </f:facet>
                                                        <h:outputText value="#{process.metadata[val][0].value}" />
                                                    </h:column>
                                                </c:forEach>
                                            </c:if>
                                            <h:column>
                                                <f:facet name="header">
                                                    <h:outputText value="#{msgs.action}" />
                                                </f:facet>
                                                <h:commandLink
                                                    styleClass="btn btn-primary fa fa-check"
                                                    action="#{Metadaten.currentPlugin.linkProcess(process)}" />
                                            </h:column>
                                        </h:dataTable>

                                        <h:outputText
                                            value="#{msgs.NORM_noHits}"
                                            rendered="#{Metadaten.currentPlugin != NULL and Metadaten.currentPlugin.showNoHitFound}"
                                            style="margin: 20px;" />
                                    </div>

                                </h:panelGroup>
                            </h:panelGroup>
                        </div>
                    </h:panelGroup>
                </div>
            </div>

    </composite:implementation>
</ui:composition>