<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites"
    xmlns:composite="http://xmlns.jcp.org/jsf/composite"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:x="http://myfaces.apache.org/tomahawk"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

    <composite:interface>
    </composite:interface>

    <composite:implementation>

        <!-- VIAF Modal -->
        <div
            class="modal fade"
            id="viafSearchBox"
            tabindex="-1"
            role="dialog"
            aria-labelledby="myModalLabel">

            <div
                class="modal-dialog modal-xxl"
                role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <a
                            href="#"
                            class="btn btn-blue pull-right"
                            title="#{msgs.cancel}"
                            data-dismiss="modal">
                            <i class="fa fa-times"></i>
                        </a>

                        <h4
                            class="modal-title"
                            id="myModalLabel">
                            <h:outputText value="#{msgs.NORM_viafSearch}" />
                        </h4>
                    </div>
                    <div class="modal-body">

                        <h:outputText
                            value="#{msgs.NORM_helpViafSearch}"
                            escape="false" />

                        <br />

                        <h:panelGroup
                            layout="block"
                            id="viaf_search"
                            styleClass="row"
                            style="margin-top: 15px;">

                            <c:if test="#{Metadaten.currentMetadataToPerformSearch.metadataDisplaytype == 'viaf' or Metadaten.currentMetadataToPerformSearch.metadataDisplaytype == 'person'}">
                                <div class="col-sm-12">
                                    <ui:repeat
                                        value="#{Metadaten.currentMetadataToPerformSearch.viafSearch.viafSearchRequest.searchParameterGroups}"
                                        var="group"
                                        varStatus="globStatus">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="searchgroup-container clearfloat">
                                                    <h:commandLink
                                                        action="#{Metadaten.currentMetadataToPerformSearch.viafSearch.viafSearchRequest.deleteGroup(globStatus.index)}"
                                                        styleClass="fa fa-times"
                                                        style="position:absolute; top:5px; right:21px;">
                                                        <f:ajax
                                                            execute=":normdataForm:viaf_search"
                                                            render=":normdataForm:viaf_search" />
                                                    </h:commandLink>
                                                    <ui:repeat
                                                        var="filter"
                                                        value="#{group.parameterList}"
                                                        varStatus="status">
                                                        <div class="row">
                                                            <div class="filter-row">
                                                                <div class="col-sm-2 control-label">
                                                                    <h:selectOneMenu
                                                                        value="#{filter.searchField}"
                                                                        styleClass="form-control">
                                                                        <f:selectItems
                                                                            value="#{Metadaten.currentMetadataToPerformSearch.viafSearch.searchFields}"
                                                                            itemLabel="#{item.label}"
                                                                            itemValue="#{item.value}"
                                                                            var="item" />
                                                                        <f:ajax
                                                                            execute="@this search_fields"
                                                                            render="search_fields" />
                                                                    </h:selectOneMenu>
                                                                </div>
                                                                <div class="col-sm-1 control-label">
                                                                    <h:selectOneMenu
                                                                        value="#{filter.operand}"
                                                                        styleClass="form-control">
                                                                        <f:selectItems value="#{Metadaten.currentMetadataToPerformSearch.viafSearch.relations}" />
                                                                    </h:selectOneMenu>
                                                                </div>
                                                                <h:panelGroup
                                                                    id="search_fields"
                                                                    layout="block"
                                                                    styleClass="col-sm-9">
                                                                    <x:inputText
                                                                        pt:dir="auto"
                                                                        rendered="#{filter.searchField != 'local.sources'}"
                                                                        value="#{filter.searchValue}"
                                                                        styleClass="form-control input"
                                                                        id="input_processes" />

                                                                    <x:selectOneMenu
                                                                        rendered="#{filter.searchField == 'local.sources'}"
                                                                        value="#{filter.searchValue}"
                                                                        styleClass="form-control input"
                                                                        id="select_databases">
                                                                        <f:selectItems
                                                                            value="#{Metadaten.currentMetadataToPerformSearch.viafSearch.searchSources}"
                                                                            itemLabel="#{item.label}"
                                                                            itemValue="#{item.value}"
                                                                            var="item" />

                                                                    </x:selectOneMenu>
                                                                </h:panelGroup>
                                                            </div>
                                                            <div class="shrink">
                                                                <h:commandLink
                                                                    action="#{group.deleteFilter(status.index)}"
                                                                    styleClass="fa fa-trash pull-right">
                                                                    <f:ajax
                                                                        execute=":normdataForm:viaf_search"
                                                                        render=":normdataForm:viaf_search" />
                                                                </h:commandLink>
                                                            </div>

                                                            <div class="clearfix"></div>
                                                        </div>
                                                    </ui:repeat>
                                                    <div class="row">
                                                        <div class="controls-row">
                                                            <h:panelGroup
                                                                styleClass="group-conjunction"
                                                                rendered="#{group.numFilters gt 1}">
                                                                <div
                                                                    class="col-sm-8"
                                                                    style="padding-top: 4px;">
                                                                    <strong>
                                                                        <h:outputText value="#{msgs.NORM_filterconjunction}:" />
                                                                    </strong>
                                                                    <h:selectOneRadio value="#{group.conjunctive}">
                                                                        <f:selectItem
                                                                            itemValue="true"
                                                                            itemLabel="#{msgs.NORM_conjunctive}" />
                                                                        <f:selectItem
                                                                            itemValue="false"
                                                                            itemLabel="#{msgs.NORM_disjunctive}" />
                                                                        <f:ajax />
                                                                    </h:selectOneRadio>
                                                                </div>
                                                            </h:panelGroup>
                                                            <div class="#{group.numFilters gt 1 ? 'col-sm-4' : 'col-sm-12'}">
                                                                <div class="new-filter-btn">
                                                                    <h:commandLink action="#{group.newFilter}">
                                                                        <f:ajax
                                                                            execute=":normdataForm:viaf_search"
                                                                            render=":normdataForm:viaf_search" />
                                                                        #{msgs.NORM_newFilter}
                                                                    </h:commandLink>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </ui:repeat>
                                    <div class="row">
                                        <div class="controls-row">
                                            <h:panelGroup styleClass="group-conjunction">
                                                <div
                                                    class="col-sm-4"
                                                    style="padding-top: 4px;">
                                                    <h:panelGroup rendered="#{Metadaten.currentMetadataToPerformSearch.viafSearch.viafSearchRequest.numGroups gt 1}">
                                                        <strong>
                                                            <h:outputText value="#{msgs.NORM_groupconjunction}:" />
                                                        </strong>
                                                        <h:selectOneRadio value="#{Metadaten.currentMetadataToPerformSearch.viafSearch.viafSearchRequest.conjunctive}">
                                                            <f:selectItem
                                                                itemValue="true"
                                                                itemLabel="#{msgs.NORM_conjunctive}" />
                                                            <f:selectItem
                                                                itemValue="false"
                                                                itemLabel="#{msgs.NORM_disjunctive}" />
                                                            <f:ajax />
                                                        </h:selectOneRadio>
                                                    </h:panelGroup>
                                                </div>

                                                <h:panelGroup
                                                    styleClass="col-sm-4"
                                                    style="padding-top: 4px;">
                                                    <strong>
                                                        <h:outputText value="#{msgs.NORM_authorityViafSortOrder}:" />
                                                    </strong>
                                                    <h:selectOneRadio value="#{Metadaten.currentMetadataToPerformSearch.viafSearch.sorting}">
                                                        <f:selectItem
                                                            itemValue="true"
                                                            itemLabel="#{msgs.NORM_authorityViafSortOptionDefault}" />
                                                        <f:selectItem
                                                            itemValue="false"
                                                            itemLabel="#{msgs.NORM_authorityViafSortOptionHoldingCount}" />
                                                        <f:ajax />
                                                    </h:selectOneRadio>
                                                    <h:outputText value="#{msgs.NORM_authorityViafSortOrderDescription}" />
                                                </h:panelGroup>


                                            </h:panelGroup>
                                            <div class="col-sm-4">
                                                <div class="new-filter-btn">
                                                    <h:commandLink action="#{Metadaten.currentMetadataToPerformSearch.viafSearch.viafSearchRequest.newGroup}">
                                                        <f:ajax
                                                            execute=":normdataForm:viaf_search"
                                                            render=":normdataForm:viaf_search" />
                                                        #{msgs.NORM_newGroup}
                                                    </h:commandLink>
                                                </div>
                                            </div>
                                        </div>
                                    </div>




                                </div>

                                <h:commandLink
                                    styleClass="btn btn-grey pull-right margin-right-10 margin-top-10 margin-bottom-10"
                                    action="#{Metadaten.currentMetadataToPerformSearch.search}"
                                    title="#{msgs.search}">
                                    <i class="fa fa-search margin-right-5"></i>
                                    <h:outputText value="#{msgs.search}" />
                                    <f:ajax
                                        execute="@form"
                                        render="viafResultList" />
                                </h:commandLink>
                            </c:if>
                        </h:panelGroup>








                        <h:panelGroup
                            layout="block"
                            id="viafResultList"
                            class="row">
                            <c:if test="#{Metadaten.currentMetadataToPerformSearch.metadataDisplaytype == 'viaf' or Metadaten.currentMetadataToPerformSearch.metadataDisplaytype == 'person'}">
                                <x:dataList
                                    value="#{Metadaten.currentMetadataToPerformSearch.viafSearch.records}"
                                    var="record">
                                    <hr />
                                    <h:panelGroup
                                        styleClass="pull-right"
                                        style="margin-right: 40px;">
                                        <a
                                            href="#{record.getFieldValues('024','7',' ','a').get(0)}"
                                            target="_blank"
                                            title="#{msgs.NORM_authorityShowClusterFileInViaf}">
                                            <img
                                                style="width: 40px;"
                                                alt="viaf"
                                                src="template/img/viaf/Viaf_icon.png" />
                                        </a>
                                    </h:panelGroup>
                                    <div
                                        class="row"
                                        style="margin: 20px;">


                                        <div class="col-sm-12">


                                            <x:dataList
                                                value="#{record.displayableData}"
                                                var="normdata">
                                                <div class="row">
                                                    <div class="col-sm-4">
                                                        <h:outputText value="#{msgs[normdata.key]}" />
                                                    </div>

                                                    <div class="col-sm-8">
                                                        <x:dataList
                                                            value="#{normdata.values}"
                                                            var="value">
                                                            <div class="row">
                                                                <div class="col-sm-12">
                                                                    <h:outputText value="#{value.text}" />
                                                                </div>
                                                            </div>
                                                        </x:dataList>
                                                    </div>
                                                </div>
                                            </x:dataList>

                                            <x:dataList
                                                value="#{record.authorityDatabaseUrls}"
                                                var="database">

                                                <div class="row">
                                                    <div class="col-sm-4">
                                                        <h:outputText value="#{msgs.NORM_authorityData}" />
                                                        <h:outputText
                                                            value="#{database.databaseCode}"
                                                            style="margin-left:5px;" />
                                                    </div>
                                                    <div class="col-sm-6">
                                                        <h:outputText value="#{database.preferedSpelling} (#{database.identifier}) " />
                                                    </div>


                                                    <h:panelGroup
                                                        layout="block"
                                                        class="col-sm-2">
                                                        <h:commandLink
                                                            styleClass="btn btn-small btn-green margin-left-5 pull-right"
                                                            action="#{Metadaten.currentMetadataToPerformSearch.getData}"
                                                            title="">
                                                            <f:setPropertyActionListener
                                                                value="#{database}"
                                                                target="#{Metadaten.currentMetadataToPerformSearch.viafSearch.currentDatabase}">
                                                            </f:setPropertyActionListener>
                                                            <f:setPropertyActionListener
                                                                value=""
                                                                target="#{Metadaten.rowIndex}" />

                                                            <f:setPropertyActionListener
                                                                value="#{record.getFieldValues('024','7',' ','a').get(0)}"
                                                                target="#{Metadaten.currentMetadataToPerformSearch.viafSearch.currentCluster}"></f:setPropertyActionListener>
                                                            <i class="fa fa-check" />
                                                        </h:commandLink>

                                                        <a
                                                            class="pull-right"
                                                            href="#{database.uiUrl}"
                                                            target="_blank"
                                                            title="#{msgs.NORM_authorityShowInViaf}">
                                                            <img
                                                                style="width: 28px;"
                                                                alt="viaf"
                                                                src="template/img/viaf/Viaf_icon.png" />
                                                        </a>
                                                        <h:panelGroup rendered="#{database.localAuthorityUrl != ''}">
                                                            <a
                                                                class="pull-right"
                                                                href="#{database.localAuthorityUrl}"
                                                                target="_blank"
                                                                title="#{msgs.NORM_authorityShowInLocalAuthority}">
                                                                <img
                                                                    alt="#{database.databaseCode}"
                                                                    src="template/img/viaf/#{database.databaseCode}.png" />
                                                            </a>
                                                        </h:panelGroup>

                                                    </h:panelGroup>
                                                </div>
                                            </x:dataList>
                                        </div>

                                    </div>
                                </x:dataList>
                                <h:outputText
                                    value="#{msgs.NORM_noHits}"
                                    rendered="#{Metadaten.currentMetadataToPerformSearch != NULL and Metadaten.currentMetadataToPerformSearch.showNoHitFound}"
                                    style="margin: 20px;" />

                            </c:if>
                        </h:panelGroup>
                    </div>
                </div>
            </div>
        </div>

    </composite:implementation>
</ui:composition>