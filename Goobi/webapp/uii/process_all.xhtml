<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:of="http://omnifaces.org/functions" xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="/uii/template/template.html" xmlns:x="http://myfaces.apache.org/tomahawk"
	xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites" xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

	<ui:param name="myPageTitle"
		value="#{ProzessverwaltungForm.modusAnzeige=='aktuell'?msgs.aktuelleProzesse:msgs.prozessvorlagen}" />

	<ui:define name="title">
		<h:outputText value="#{myPageTitle}" />
	</ui:define>

	<ui:define name="breadcrumb">
		<intranda:breadcrumb id="id2" label="#{DashboardForm.plugin==null?msgs.startseite:msgs.dashboard}" action="index"
			navId="a0" />
		<intranda:breadcrumb id="processAll" label="#{myPageTitle}" action="process_all" noSeparator="#{true}" />
	</ui:define>

	<ui:define name="info">
	</ui:define>

	<ui:define name="content">

		<c:if test="#{LoginForm.hasRole('Workflow_Processes') or LoginForm.hasRole('Workflow_ProcessTemplates')}">

			<div class="row">
				<div class="col-sm-12">
					<div class="box box-color box-bordered">
						<div class="box-title">
							<h3>
								<i class="fa fa-tasks"></i>
								<h:outputText value="#{myPageTitle}" />
							</h3>
						</div>
						<div class="box-content nopadding">
							<div class="dataTables_wrapper">
								<div class="row">
								
									<h:form id="searchform">

										<div class="col-md-1">
											<div class="dataTables_length" style="margin-bottom: 10px;">
												<h:commandLink class="font-black" action="#{ProzessverwaltungForm.generateFilterWithIdentfiers}" title="#{msgs.process_generateFilterQueryForHits}">
													<i class="btn fa fa-filter margin-right-5" />
													<h:outputText value="#{msgs.treffer}: #{ProzessverwaltungForm.paginator.totalResults}"/>
												</h:commandLink>
											</div>
										</div>

										<div class="col-md-11">
											<x:aliasBeansScope>
												<x:aliasBean alias="#{Form}" value="#{ProzessverwaltungForm}" />
												<x:aliasBean alias="#{label}"
													value="#{ProzessverwaltungForm.modusAnzeige=='aktuell'?msgs.filterProcesses:msgs.filterProcessTemplates}" />
												<f:subview id="sub1">
													<ui:include src="includes/task/list_searchAndSave.xhtml" />
												</f:subview>
											</x:aliasBeansScope>

											<ui:include src="includes/process/list_filterAndDisplay.xhtml" />
										</div>

									</h:form>
								</div>
								<h:form id="myform">

									<!-- +++++++++++++++++  Display as grid ++++++++++++++++++++++++ -->
									<h:panelGroup
										rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['gridview']}">

										<ui:include src="includes/process/list_grid.xhtml" />

									</h:panelGroup>

									<!-- +++++++++++++++++  Display as table ++++++++++++++++++++++++ -->
									<x:dataTable id="processTable" rowIndexVar="count"
										styleClass="table table-hover table-nomargin dataTable table-bordered responsive" var="item"
										value="#{ProzessverwaltungForm.paginator.list}"
										rendered="#{ProzessverwaltungForm.modusAnzeige=='vorlagen' or not ProzessverwaltungForm.anzeigeAnpassen['gridview']}">

										<!-- +++++++++++++++++  SelectionBoxes ++++++++++++++++++++++++ -->
										<x:column styleClass="tableColumnOverflow width120"
											rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['selectionBoxes']}">
											<f:facet name="header">
												<x:div>
													<!-- Header -->
													<h:outputText value="#{msgs.auswahl2}" />

													<h:commandLink action="#{ProzessverwaltungForm.SelectionAll}" id="selectall" title="#{msgs.alleAuswaehlen}">
														<i class="fa fa-check-square-o font-black margin-left-5" />
													</h:commandLink>
													<h:commandLink action="#{ProzessverwaltungForm.SelectionNone}" id="selectnone"
														title="#{msgs.auswahlEntfernen}">
														<i class="fa fa-square-o font-black margin-left-5" />
													</h:commandLink>
												</x:div>
											</f:facet>
											<h:commandLink>
												<i class="font-black #{item.selected?'fa fa-check-square-o':'fa fa-square-o'}" />
												<f:setPropertyActionListener target="#{item.selected}" value="#{item.selected?false:true}" />
												<f:ajax render=":myform" />
											</h:commandLink>
										</x:column>

										<!-- +++++++++++++++++  ProzessID ++++++++++++++++++++++++ -->
										<x:column styleClass="tableColumnOverflow width80"
											rendered="#{ProzessverwaltungForm.anzeigeAnpassen['processId']}"
											headerstyleClass="#{ProzessverwaltungForm.sortierung=='idDesc'?'sorting_desc':ProzessverwaltungForm.sortierung=='idAsc'?'sorting_asc':'sorting'}">
											<f:facet name="header">
												<h:commandLink styleClass="font-black-block" action="#{ProzessverwaltungForm.FilterAlleStart}">
													<h:outputText value="#{msgs.id}" />
													<f:setPropertyActionListener target="#{ProzessverwaltungForm.sortierung}"
														value="#{ProzessverwaltungForm.sortierung=='idAsc'?'idDesc':'idAsc'}" />
													<f:ajax render=":myform" />
												</h:commandLink>
											</f:facet>
											<h:outputText value="#{item.id}" />
										</x:column>
									 
										<!-- +++++++++++++++++  Thumbnail ++++++++++++++++++++++++ -->
										<x:column styleClass="width80" rendered="#{ProzessverwaltungForm.anzeigeAnpassen['thumbnail'] and ProzessverwaltungForm.modusAnzeige!='vorlagen'}">
											<f:facet name="header">
												<h:outputText value="#{msgs.thumbnail}" />
											</f:facet>
											<canvas class="thumb-canvas" style="width: 150px;"
												data-image_small="#{HelperForm.servletPathWithHostAsUrl}/#{item.representativeImage}&amp;width=150&amp;height=150"
												data-image_large="#{HelperForm.servletPathWithHostAsUrl}/#{item.representativeImage}&amp;width=450&amp;height=450"
												id="thumbnail-#{count}">
                                        </canvas>
										</x:column>

										<!-- +++++++++++++++++  Embedded metadata ++++++++++++++++++++++++ -->
										<x:column styleClass="tableColumnOverflow maxWidth300"
											rendered="#{ProzessverwaltungForm.anzeigeAnpassen['metadatadetails'] and ProzessverwaltungForm.modusAnzeige!='vorlagen'}">
											<f:facet name="header">
												<h:outputText value="#{msgs.metadata}" />
											</f:facet>
											<table>
												<ui:repeat var="metadata" value="#{item.metadataList}" varStatus="metadatastatus" id="metadatalist">
													<h:panelGroup
														rendered="#{metadata.one == 'TitleDocMain'
														 or metadata.one == 'Author'
														 or metadata.one == 'PlaceOfPublication'
														 or metadata.one == 'PublicationYear'
														 or metadata.one == 'PublisherName'
														 or metadata.one == 'CatalogIDDigital'
														 or metadata.one == 'shelfmarksource'}">
														<tr>
															<td style="border: none !important; padding: 2px; vertical-align: top;"><h:outputText
																	value="#{msgs['process_grid_'.concat(metadata.one)]}:" /></td>
															<td style="border: none !important; padding: 2px; white-space: normal;"><h:outputText
																	value="#{metadata.two}" /></td>
														</tr>
													</h:panelGroup>
												</ui:repeat>
											</table>
										</x:column>

										<!-- +++++++++++++++++  Tests with properties ++++++++++++++++++++++++ 
                                     <x:column styleClass="tableColumnOverflow maxWidth300"  rendered="#{ProzessverwaltungForm.anzeigeAnpassen['metadatadetails']}">
                                         <f:facet name="header">
                                             <h:outputText value="#{msgs.eigenschaften}" />
                                         </f:facet>
                                         <table>
    	                                     <ui:repeat var="prop" value="#{item.eigenschaften}" varStatus="propstatus" id="proplist">
                                                    <tr>
	                                                	<td style="border: none #ddd;padding: 2px;vertical-align:top;">
															<h:outputText value="#{prop.titel}:" />
	                                                	</td>
	                                                	<td style="border: none #ddd;padding: 2px; white-space: normal;">
	                                                		<h:outputText value="#{prop.wert}" />
	                                                	</td>
		 										 	</tr>
	 										 </ui:repeat>
                                         </table>
                                     </x:column>
									-->

										<!-- +++++++++++++++++  BatchID ++++++++++++++++++++++++ -->
										<x:column styleClass="tableColumnOverflow width80"
											rendered="#{ProzessverwaltungForm.anzeigeAnpassen['batchId'] and ProzessverwaltungForm.modusAnzeige!='vorlagen'}"
											headerstyleClass="#{ProzessverwaltungForm.sortierung=='batchDesc'?'sorting_desc':ProzessverwaltungForm.sortierung=='batchAsc'?'sorting_asc':'sorting'}">
											<f:facet name="header">
												<h:commandLink styleClass="font-black-block" action="#{ProzessverwaltungForm.FilterAlleStart}">
													<h:outputText value="#{msgs.batch}" />
													<f:setPropertyActionListener target="#{ProzessverwaltungForm.sortierung}"
														value="#{ProzessverwaltungForm.sortierung=='batchAsc'?'batchDesc':'batchAsc'}" />
													<f:ajax render=":myform" />
												</h:commandLink>
											</f:facet>
											<h:outputText value="#{item.batch.batchId}" rendered="#{item.batch != null}" />
											<h:outputText value=" (#{item.batch.batchName})"
												rendered="#{item.batch != null and item.batch.batchName != null}" />
										</x:column>

										<!-- +++++++++++++++++  alle Schritte auflisten ++++++++++++++++++++++++ -->
										<x:column rendered="true" id="ajaxcolumn" styleClass="tableColumnOverflow maxWidth300"
											headerstyleClass="#{ProzessverwaltungForm.sortierung=='titelDesc'?'sorting_desc':ProzessverwaltungForm.sortierung=='titelAsc'?'sorting_asc':'sorting'}">
											<f:facet name="header">
												<h:commandLink styleClass="font-black-block" action="#{ProzessverwaltungForm.FilterAlleStart}">
													<h:outputText value="#{ProzessverwaltungForm.modusAnzeige=='aktuell'?msgs.prozessTitel:msgs.titel}" />
													<f:setPropertyActionListener target="#{ProzessverwaltungForm.sortierung}"
														value="#{ProzessverwaltungForm.sortierung=='titelAsc'?'titelDesc':'titelAsc'}" />
													<f:ajax render=":myform" />
												</h:commandLink>
											</f:facet>

											<ui:include src="includes/ajaxPlusMinusButton.xhtml" />

											<h:panelGroup rendered="#{item.panelAusgeklappt}">
												<div class="box box-small box-color box-bordered">
													<div class="box-title">
														<h3>
															<i class="fa fa-list"></i> #{msgs.details}
														</h3>
													</div>
													<div class="box-content nopadding">

														<x:dataTable styleClass="table table-hover table-bordered" id="prozessdetails" var="step"
															value="#{item.schritteList}">

															<h:column>
																<f:facet name="header">
																	<h:outputText value="#{msgs.nr}" />
																</f:facet>
																<h:outputText value="#{step.reihenfolge}"
																	styleClass="#{step.bearbeitungsstatusEnum == 'DEACTIVATED'?'font-light':''}" />
															</h:column>

															<h:column>
																<f:facet name="header">
																	<h:outputText value="#{msgs.titel}" style="white-space: normal;" />
																</f:facet>
																<h:panelGroup rendered="#{step.typAutomatisch}">
																	<i class="fa fa-cogs font-light margin-right-10" title="#{msgs.automatischerSchritt}" />
																</h:panelGroup>
																<h:panelGroup rendered="#{not step.typAutomatisch}">
																	<i class="fa fa-user-o font-light margin-right-10" title="#{msgs.normalerSchritt}" />
																</h:panelGroup>
																<h:outputText value="#{step.titelLokalisiert}" title="#{step.titel}" style="white-space: normal;"
																	styleClass="#{step.bearbeitungsstatusEnum == 'DEACTIVATED'?'font-light':''}" />
															</h:column>

															<h:column>
																<f:facet name="header">
																	<h:outputText value="#{msgs.status}" />
																</f:facet>

																<ul class="colors small13">
																	<h:panelGroup rendered="#{step.bearbeitungsstatusEnum == 'LOCKED'}">
																		<li
																			class="statusSmall #{(NavigationForm.showEasyRead?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																			title="#{msgs.statusGesperrt}" rel="tooltip" />
																	</h:panelGroup>
																	<h:panelGroup rendered="#{step.bearbeitungsstatusEnum == 'OPEN'}">
																		<li
																			class="statusSmall #{(NavigationForm.showEasyRead?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																			title="#{msgs.statusOffen}" rel="tooltip" />
																	</h:panelGroup>

																	<h:panelGroup rendered="#{step.bearbeitungsstatusEnum == 'DONE' and HelperForm.anonymized}">
																		<li
																			class="statusSmall #{(NavigationForm.showEasyRead?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																			rel="tooltip" title="#{step.bearbeitungsstatusEnum.title} #{step.editTypeEnum.title}" />
																	</h:panelGroup>
																	<h:panelGroup rendered="#{step.bearbeitungsstatusEnum == 'INWORK' and HelperForm.anonymized}">
																		<li
																			class="statusSmall #{(NavigationForm.showEasyRead?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																			rel="tooltip" title="#{step.bearbeitungsstatusEnum.title}: #{step.editTypeEnum.title}" />
																	</h:panelGroup>

																	<h:panelGroup rendered="#{step.bearbeitungsstatusEnum == 'DONE' and !HelperForm.anonymized}">
																		<li
																			class="statusSmall #{(NavigationForm.showEasyRead?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																			rel="tooltip"
																			title="#{step.bearbeitungsstatusEnum.title}: #{step.bearbeitungsbenutzer!=null and step.bearbeitungsbenutzer.id!=0?step.bearbeitungsbenutzer.nachVorname:''} (#{step.bearbeitungszeitpunkt !=null?step.bearbeitungszeitpunktAsFormattedString:''})  - #{step.editTypeEnum.title}" />
																	</h:panelGroup>
																	<h:panelGroup rendered="#{step.bearbeitungsstatusEnum == 'INWORK' and !HelperForm.anonymized}">
																		<li
																			class="statusSmall #{(NavigationForm.showEasyRead?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																			rel="tooltip"
																			title="#{step.bearbeitungsstatusEnum.title}: #{step.bearbeitungsbenutzer!=null and step.bearbeitungsbenutzer.id!=0?step.bearbeitungsbenutzer.nachVorname:''} (#{step.bearbeitungszeitpunkt !=null?step.bearbeitungszeitpunktAsFormattedString:''})  - #{step.editTypeEnum.title}" />
																	</h:panelGroup>
																	<h:panelGroup rendered="#{step.bearbeitungsstatusEnum == 'ERROR' and !HelperForm.anonymized}">
																		<li
																			class="statusSmall #{(NavigationForm.showEasyRead?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																			rel="tooltip"
																			title="#{step.bearbeitungsstatusEnum.title}: #{step.bearbeitungsbenutzer!=null and step.bearbeitungsbenutzer.id!=0?step.bearbeitungsbenutzer.nachVorname:''} (#{step.bearbeitungszeitpunkt !=null?step.bearbeitungszeitpunktAsFormattedString:''})  - #{step.editTypeEnum.title}" />
																	</h:panelGroup>
																	<h:panelGroup rendered="#{step.bearbeitungsstatusEnum == 'ERROR' and HelperForm.anonymized}">
																		<li
																			class="statusSmall #{(NavigationForm.showEasyRead?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																			rel="tooltip" title="#{step.bearbeitungsstatusEnum.title}: #{step.editTypeEnum.title}" />
																	</h:panelGroup>

																	<h:panelGroup rendered="#{step.bearbeitungsstatusEnum == 'DEACTIVATED'}">
																		<li
																			class="statusSmall #{(NavigationForm.showEasyRead?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																			title="#{step.bearbeitungsstatusEnum.title}" rel="tooltip" />
																	</h:panelGroup>
																</ul>
																<h:outputText value="#{step.bearbeitungsstatusEnum.title}" rendered="#{NavigationForm.showEasyRead}" />
															</h:column>

														</x:dataTable>

													</div>
												</div>

											</h:panelGroup>
										</x:column>

										<!-- +++++++++++++++++  Custom columns ++++++++++++++++++++++++ -->
										<c:forEach items="#{LoginForm.listOfCustomColumns}" var="var">
											<x:column rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen'}">
												<f:facet name="header">
													<h:outputText value="#{msgs[fn:substring(var, fn:indexOf(var,'.') lt 0 ? 1 : fn:indexOf(var,'.') + 1, var.length() - fn.indexOf(var,'.') - 1)]}" />
												</f:facet>
												<h:outputText value="#{item.getReplacedVariable(var)}" />
											</x:column>
										</c:forEach>
										
										<!-- +++++++++++++++++  Vorgangsdatum ++++++++++++++++++++++++ -->
										<x:column styleClass="tableColumnOverflow width150"
											rendered="#{ProzessverwaltungForm.anzeigeAnpassen['processDate']}"
											headerstyleClass="#{ProzessverwaltungForm.sortierung=='vorgangsdatumDesc'?'sorting_desc':ProzessverwaltungForm.sortierung=='vorgangsdatumAsc'?'sorting_asc':'sorting'}">
											<f:facet name="header">
												<h:commandLink styleClass="font-black-block" action="#{ProzessverwaltungForm.FilterAlleStart}">
													<h:outputText value="#{msgs.vorgangsdatum}" />
													<f:setPropertyActionListener target="#{ProzessverwaltungForm.sortierung}"
														value="#{ProzessverwaltungForm.sortierung=='vorgangsdatumAsc'?'vorgangsdatumDesc':'vorgangsdatumAsc'}" />
													<f:ajax render=":myform" />
												</h:commandLink>
											</f:facet>

											<h:outputText value="#{item.erstellungsdatumAsString}">
												<!--                                         	<f:convertDateTime locale="#{SpracheForm.locale}" type="date" dateStyle="medium"/> -->
											</h:outputText>
										</x:column>

										<!-- +++++++++++++++++  Status ++++++++++++++++++++++++ -->
										<x:column styleClass="tableColumnOverflow width200"
											headerstyleClass="#{ProzessverwaltungForm.sortierung=='fortschrittDesc'?'sorting_desc':ProzessverwaltungForm.sortierung=='fortschrittAsc'?'sorting_asc':'sorting'}">
											<f:facet name="header">
												<h:commandLink styleClass="font-black-block" action="#{ProzessverwaltungForm.FilterAlleStart}">
													<h:outputText value="#{msgs.status}" />
													<f:setPropertyActionListener target="#{ProzessverwaltungForm.sortierung}"
														value="#{ProzessverwaltungForm.sortierung=='fortschrittAsc'?'fortschrittDesc':'fortschrittAsc'}" />
													<f:ajax render=":myform" />
												</h:commandLink>
											</f:facet>

											<div class="progress margin-bottom-no" title="#{msgs.status}" style="border: 0px solid black;">
												<h:panelGroup rendered="#{item.fortschritt3 gt 0}" title="#{msgs.statusAbgeschlossen}" data-toggle="tooltip"
													styleClass="progress-bar #{(NavigationForm.showEasyRead?('easy-read-progressbar-status-done'):('progress-bar-success'))}"
													style="width: #{item.fortschritt3}%;" />
												<h:panelGroup rendered="#{item.fortschritt2 gt 0}" title="#{msgs.statusOffen}" data-toggle="tooltip"
													styleClass="progress-bar #{(NavigationForm.showEasyRead?('easy-read-progressbar-status-open'):('progress-bar-warning'))}"
													style="width: #{item.fortschritt2}%;" />
												<h:panelGroup rendered="#{item.fortschrittError gt 0}" title="#{msgs.statusError}" data-toggle="tooltip"
													styleClass="progress-bar #{(NavigationForm.showEasyRead?('easy-read-progressbar-status-error'):('progress-bar-danger progressbar-status-error'))} "
													style="width: #{item.fortschrittError}%;" />
												<h:panelGroup rendered="#{item.fortschritt1 gt 0}" title="#{msgs.statusGesperrt}" data-toggle="tooltip"
													styleClass="progress-bar #{(NavigationForm.showEasyRead?('easy-read-progressbar-status-locked'):('progress-bar-danger'))} "
													style="width: #{item.fortschritt1}%;" />
											</div>

										</x:column>


										<x:column styleClass="tableColumnOverflow maxWidth120"
											headerstyleClass="#{ProzessverwaltungForm.sortierung=='projektDesc'?'sorting_desc':ProzessverwaltungForm.sortierung=='projektAsc'?'sorting_asc':'sorting'}">
											<f:facet name="header">
												<!-- Header -->
												<h:commandLink styleClass="font-black-block" action="#{ProzessverwaltungForm.FilterAlleStart}"
													title="#{msgs.projekt}">
													<h:outputText value="#{msgs.projekt}" />
													<f:setPropertyActionListener target="#{ProzessverwaltungForm.sortierung}"
														value="#{ProzessverwaltungForm.sortierung=='projektAsc'?'projektDesc':'projektAsc'}" />
													<f:ajax render=":myform" />
												</h:commandLink>
											</f:facet>
											<h:outputText value="#{item.projekt.titel}" />
										</x:column>


										<x:column styleClass="tableColumnOverflow maxWidth120"
											rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['lockings']}">
											<f:facet name="header">
												<x:div>
													<!-- Header -->
													<h:outputText value="#{msgs.sperrungen}" />

												</x:div>
											</f:facet>
											<h:outputText value="#{item.benutzerGesperrt.nachVorname}" rendered="#{item.benutzerGesperrt != null}" />
										</x:column>



										<!-- +++++++++++++++++  Swapped out ++++++++++++++++++++++++ -->
										<x:column styleClass="tableColumnOverflow width100"
											rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['swappedOut']}">
											<f:facet name="header">
												<x:div>
													<!-- Header -->
													<h:outputText value="#{msgs.ausgelagert}" />
												</x:div>
											</f:facet>
											<i class="fa #{item.swappedOutGui?'fa-check-square-o':'fa-square-o'}" />
										</x:column>

										<x:column styleClass="width200">
											<f:facet name="header">
												<h:outputText value="#{msgs.auswahl}" />
											</f:facet>

											<!-- Bearbeiten-Schaltknopf -->
											<h:commandLink action="#{ProzessverwaltungForm.editProcess}" id="edit"
												rendered="#{LoginForm.hasRole('Workflow_General_Details')}" rel="tooltip" onclick="preventDoubleSubmit(this);"
												title="#{ProzessverwaltungForm.modusAnzeige=='aktuell'?msgs.prozessBearbeiten:msgs.process_editTemplate}">
												<i class="btn fa fa-pencil" />
												<f:passThroughAttribute name="data-toggle" value="tooltip" />
												<x:updateActionListener property="#{ProzessverwaltungForm.myProzess}" value="#{item}" />
												<x:updateActionListener property="#{ProzessverwaltungForm.modusBearbeiten}" value="" />
											</h:commandLink>

											<!-- Duplicate process template -->
											<h:commandLink action="#{ProzessverwaltungForm.cloneProcess}" rel="tooltip" onclick="preventDoubleSubmit(this);"
												rendered="#{LoginForm.hasRole('Workflow_ProcessTemplates_Clone') and (ProzessverwaltungForm.modusAnzeige=='vorlagen')}"
												title="#{msgs.duplicateWorkflow}" onclick="if (!confirm('#{msgs.wirklichAusfuehren}')) return false">
												<i class="btn fa fa-clipboard" />
												<f:passThroughAttribute name="data-toggle" value="tooltip" />
												<x:updateActionListener property="#{ProzessverwaltungForm.myProzess}" value="#{item}" />
											</h:commandLink>

											<!-- Metadaten-Schaltknopf - Read only -->
											<h:commandLink action="#{Metadaten.XMLlesen}" id="action14" rel="tooltip" title="#{msgs.metadatenBearbeiten}" onclick="preventDoubleSubmit(this);"
												rendered="#{(!LoginForm.hasRole('Task_Mets_Pagination') and !LoginForm.hasRole('Task_Mets_Structure') and !LoginForm.hasRole('Task_Mets_Metadata') and !LoginForm.hasRole('Task_Mets_Files')) and item.benutzerGesperrt == null and ProzessverwaltungForm.modusAnzeige!='vorlagen'}">
												<i class="btn fa fa-book" />
												<f:passThroughAttribute name="data-toggle" value="tooltip" />
												<f:param name="nurLesen" value="true" />
												<f:param name="ProzesseID" value="#{item.id}" />
												<f:param name="BenutzerID" value="#{LoginForm.myBenutzer.id}" />
												<f:param name="zurueck" value="process_all" />
											</h:commandLink>

											<!-- Metadaten-Schaltknopf - Allow writing -->
											<h:commandLink action="#{Metadaten.XMLlesen}" id="action15" rel="tooltip" title="#{msgs.metadatenBearbeiten}" onclick="preventDoubleSubmit(this);"
												rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and (LoginForm.hasRole('Task_Mets_Pagination') or LoginForm.hasRole('Task_Mets_Structure') or LoginForm.hasRole('Task_Mets_Metadata') or LoginForm.hasRole('Task_Mets_Files')) and !item.temporaryMetadataFiles}">
												<i class="btn fa fa-book " />
												<f:passThroughAttribute name="data-toggle" value="tooltip" />
												<f:param name="ProzesseID" value="#{item.id}" />
												<f:param name="BenutzerID" value="#{LoginForm.myBenutzer.id}" />
												<f:param name="zurueck" value="process_all" />
												<c:if test="#{LoginForm.hasRole('Task_Mets_Files')}">
													<f:setPropertyActionListener value="File" target="#{Metadaten.modusAnsicht}" />
												</c:if>
												<c:if test="#{LoginForm.hasRole('Task_Mets_Metadata')}">
													<f:setPropertyActionListener value="Metadaten" target="#{Metadaten.modusAnsicht}" />
												</c:if>
												<c:if test="#{LoginForm.hasRole('Task_Mets_Structure')}">
													<f:setPropertyActionListener value="Strukturdaten" target="#{Metadaten.modusAnsicht}" />
												</c:if>
												<c:if test="#{LoginForm.hasRole('Task_Mets_Pagination')}">
													<f:setPropertyActionListener value="Paginierung" target="#{Metadaten.modusAnsicht}" />
												</c:if>
												<f:setPropertyActionListener value="#{null}" target="#{NavigationForm.uiStatus.mets_toc1}" />
												<f:setPropertyActionListener value="#{null}" target="#{NavigationForm.uiStatus.mets_toc2}" />
												<f:setPropertyActionListener value="#{null}" target="#{NavigationForm.uiStatus.mets_toc3}" />
												<f:setPropertyActionListener value="#{null}" target="#{NavigationForm.uiStatus.mets_toc4}" />
												<f:setPropertyActionListener value="#{null}" target="#{NavigationForm.uiStatus.mets_toc5}" />
											</h:commandLink>

											<!--  modal rendern  -->
											<h:panelGroup
												rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and (LoginForm.hasRole('Task_Mets_Pagination') or LoginForm.hasRole('Task_Mets_Structure') or LoginForm.hasRole('Task_Mets_Metadata') or LoginForm.hasRole('Task_Mets_Files')) and item.temporaryMetadataFiles}">
												<a class="text_head" rel="tooltip" title="#{msgs.metadatenBearbeiten}" href="#" data-toggle="modal"
													data-target="#myModal-#{count}"> <i class="btn fa fa-book " />
												</a>
											</h:panelGroup>
											<div class="modal fade" id="myModal-#{count}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
												<div class="modal-dialog" role="document">
													<div class="modal-content">
														<div class="modal-header">

															<a href="#" class="btn btn-blue pull-right" title="#{msgs.cancel}" data-dismiss="modal"> <i
																class="fa fa-times"></i>
															</a>
															<h4 class="modal-title" id="myModalLabel">
																<h:outputText value="#{msgs.metseditorOpen}" />
															</h4>
														</div>
														<div class="modal-body">
															<h:outputText value="#{msgs.metseditorTemporaryDataExplanation}" />
														</div>
														<div class="modal-footer">

															<h:commandLink action="#{Metadaten.XMLlesen}" id="action15a" title="#{msgs.discard}" rel="tooltip"
																styleClass="btn btn-lightred pull-left">
																<i class="fa fa-trash-o margin-right-10"></i>
																<h:outputText value="#{msgs.discard}" />
																<f:passThroughAttribute name="data-toggle" value="tooltip" />
																<f:param name="ProzesseID" value="#{item.id}" />
																<f:param name="BenutzerID" value="#{LoginForm.myBenutzer.id}" />
																<f:param name="zurueck" value="process_all" />
																<f:param name="discardChanges" value="true" />
																<f:setPropertyActionListener value="#{null}" target="#{NavigationForm.uiStatus.mets_toc1}" />
																<f:setPropertyActionListener value="#{null}" target="#{NavigationForm.uiStatus.mets_toc2}" />
																<f:setPropertyActionListener value="#{null}" target="#{NavigationForm.uiStatus.mets_toc3}" />
																<f:setPropertyActionListener value="#{null}" target="#{NavigationForm.uiStatus.mets_toc4}" />
																<f:setPropertyActionListener value="#{null}" target="#{NavigationForm.uiStatus.mets_toc5}" />
															</h:commandLink>

															<h:commandLink action="#{Metadaten.XMLlesen}" id="action15b" title="#{msgs.overwrite}" rel="tooltip"
																styleClass="btn btn-green">
																<i class="fa fa-floppy-o margin-right-10"></i>
																<h:outputText value="#{msgs.overwrite}" />
																<f:passThroughAttribute name="data-toggle" value="tooltip" />
																<f:param name="ProzesseID" value="#{item.id}" />
																<f:param name="BenutzerID" value="#{LoginForm.myBenutzer.id}" />
																<f:param name="zurueck" value="process_all" />
																<f:param name="overwriteChanges" value="true" />
																<f:setPropertyActionListener value="#{null}" target="#{NavigationForm.uiStatus.mets_toc1}" />
																<f:setPropertyActionListener value="#{null}" target="#{NavigationForm.uiStatus.mets_toc2}" />
																<f:setPropertyActionListener value="#{null}" target="#{NavigationForm.uiStatus.mets_toc3}" />
																<f:setPropertyActionListener value="#{null}" target="#{NavigationForm.uiStatus.mets_toc4}" />
																<f:setPropertyActionListener value="#{null}" target="#{NavigationForm.uiStatus.mets_toc5}" />
															</h:commandLink>

														</div>
													</div>
												</div>
											</div>


											<!-- DMS-Export-Schaltknopf -->
											<h:commandLink action="#{ProzessverwaltungForm.ExportDMS}" id="action21" rel="tooltip" onclick="preventDoubleSubmit(this);"
												title="#{msgs.importDms}" styleClass="font-light"
												rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and LoginForm.hasRole('Workflow_Processes_Allow_Export') and item.displayDMSButton}">
												<i class="btn fa fa-globe" />
												<f:passThroughAttribute name="data-toggle" value="tooltip" />
												<x:updateActionListener property="#{ProzessverwaltungForm.myProzess}" value="#{item}" />
											</h:commandLink>

											<!-- DMS-Export-Schaltknopf greyed -->
											<h:commandLink action="#{ProzessverwaltungForm.ExportDMS}" disabled="true" rel="tooltip" 
												title="#{msgs.importDms}"
												rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and LoginForm.hasRole('Workflow_Processes_Allow_Export') and !item.displayDMSButton}">
												<i class="btn font-light fa fa-globe" />
												<f:passThroughAttribute name="data-toggle" value="tooltip" />
												<x:updateActionListener property="#{ProzessverwaltungForm.myProzess}" value="#{item}" />
											</h:commandLink>

											<!-- ProzessKopie-Schaltknopf -->
											<h:commandLink action="#{ProzesskopieForm.Prepare}" id="action22" rel="tooltip" onclick="preventDoubleSubmit(this);"
												title="#{item.containsUnreachableSteps?msgs.prozessvorlageMitUnvollstaendigenSchrittdetails:msgs.eineKopieDieserProzessvorlageAnlegen}"
												rendered="#{ProzessverwaltungForm.modusAnzeige=='vorlagen' and LoginForm.hasRole('Workflow_ProcessTemplates_Import_Single') and ProzesskopieForm.availableProjects.size() eq 1}">
												<i class="btn fa #{item.containsUnreachableSteps?'fa-file-o btn-danger':'fa-file-o btn-primary'} " />
												<f:passThroughAttribute name="data-toggle" value="tooltip" />
												<x:updateActionListener property="#{ProzesskopieForm.prozessVorlage}" value="#{item}" />
											</h:commandLink>

											<h:panelGroup
												rendered="#{ProzessverwaltungForm.modusAnzeige=='vorlagen' and LoginForm.hasRole('Workflow_ProcessTemplates_Import_Single') and ProzesskopieForm.availableProjects.size() gt 1}">
												<div class="btn-group" title="#{item.containsUnreachableSteps?msgs.prozessvorlageMitUnvollstaendigenSchrittdetails:msgs.eineKopieDieserProzessvorlageAnlegen}" data-toggle="tooltip">
													<a class="btn #{item.containsUnreachableSteps?'btn-danger':'btn-primary'} dropdown-toggle fa pull-right"
														style="padding-left: 4px; padding-right: 4px;" data-toggle="dropdown"> <span class="caret"></span>
													</a>
													<h:commandLink action="#{ProzesskopieForm.Prepare}" rel="tooltip">
														<i class="btn fa #{item.containsUnreachableSteps?'fa-file-o btn-danger':'fa-file-o btn-primary'} " 
															style="padding-left: 7px; padding-right: 7px;"/>
														<f:passThroughAttribute name="data-toggle" value="tooltip" />
														<x:updateActionListener property="#{ProzesskopieForm.prozessVorlage}" value="#{item}" />
													</h:commandLink>
													<ul class="dropdown-menu  pull-right">
														<ui:repeat var="proj" value="#{ProzesskopieForm.availableProjects}">
															<li>
																<h:commandLink action="#{ProzesskopieForm.Prepare}">
																	<h:outputText value="#{proj.titel}" />
																	<x:updateActionListener property="#{item.projekt}" value="#{proj}" />
																	<x:updateActionListener property="#{ProzesskopieForm.prozessVorlage}" value="#{item}" />
																</h:commandLink>
															</li>
														</ui:repeat>
													</ul>
												</div>
											</h:panelGroup>

											<!-- MassenImport -->
											<h:commandLink action="#{MassImportForm.Prepare}" id="action222" rel="tooltip" title="#{msgs.MassenImport}" onclick="preventDoubleSubmit(this);"
												rendered="#{ProzessverwaltungForm.modusAnzeige=='vorlagen' and HelperForm.massImportAllowed and LoginForm.hasRole('Workflow_ProcessTemplates_Import_Multi') and ProzesskopieForm.availableProjects.size() eq 1}">
												<i class="btn fa #{item.containsUnreachableSteps?'fa-files-o btn-danger':'fa-files-o btn-primary'} " />
												<f:passThroughAttribute name="data-toggle" value="tooltip" />
												<x:updateActionListener property="#{MassImportForm.template}" value="#{item}" />
											</h:commandLink>
											
											<h:panelGroup
												rendered="#{ProzessverwaltungForm.modusAnzeige=='vorlagen' and HelperForm.massImportAllowed and LoginForm.hasRole('Workflow_ProcessTemplates_Import_Multi') and ProzesskopieForm.availableProjects.size() gt 1}">
												<div class="btn-group" title="#{msgs.MassenImport}" data-toggle="tooltip">
													<a class="btn #{item.containsUnreachableSteps?'btn-danger':'btn-primary'} dropdown-toggle fa pull-right"
														style="padding-left: 4px; padding-right: 4px;" data-toggle="dropdown"> <span class="caret"></span>
													</a>
													<h:commandLink action="#{MassImportForm.Prepare}" rel="tooltip" >
														<i class="btn fa #{item.containsUnreachableSteps?'fa-files-o btn-danger':'fa-files-o btn-primary'} " 
															style="padding-left: 7px; padding-right: 7px;"/>
														<f:passThroughAttribute name="data-toggle" value="tooltip" />
														<x:updateActionListener property="#{MassImportForm.template}" value="#{item}" />
													</h:commandLink>
													<ul class="dropdown-menu  pull-right">
														<ui:repeat var="proj" value="#{ProzesskopieForm.availableProjects}">
															<li>
																<h:commandLink action="#{MassImportForm.Prepare}">
																	<h:outputText value="#{proj.titel}" />
																	<x:updateActionListener property="#{item.projekt}" value="#{proj}" />
																	<x:updateActionListener property="#{item.projectId}" value="#{proj.id}" />
																	<x:updateActionListener property="#{MassImportForm.template}" value="#{item}" />
																</h:commandLink>
															</li>
														</ui:repeat>
													</ul>
												</div>
											</h:panelGroup>


											<h:panelGroup
												rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and (LoginForm.hasRole('Workflow_Processes_Allow_Download') or LoginForm.hasRole('Workflow_Processes_Allow_Linking'))}">
												<div class="btn-group margin-left-10" title="#{msgs.additionalOptions}" data-toggle="tooltip">

													<a class="btn dropdown-toggle fa fa-cog" data-toggle="dropdown"> <span class="caret"></span>
													</a>
													<ul class="dropdown-menu pull-right">

														<h:panelGroup rendered="#{LoginForm.hasRole('Workflow_Processes_Allow_Linking')}">
															<li>
																<!-- Download-Schaltknopf -->
																<h:commandLink action="#{ProzessverwaltungForm.DownloadToHome}" id="action16"
																	title="#{msgs.imHomeVerzeichnisVerlinken}"
																	rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and !item.imageFolderInUse}">
																	<i class="fa fa-cloud-download margin-right-10" />
																	<h:outputText value="#{msgs.imHomeVerzeichnisVerlinken}" />
																	<x:updateActionListener property="#{ProzessverwaltungForm.myProzess}" value="#{item}" />
																</h:commandLink>
															</li>
															<li>
																<!-- Download-Schaltknopf -->
																<h:commandLink action="#{ProzessverwaltungForm.DownloadToHome}" id="action17"
																	title="#{msgs.imHomeVerzeichnisVerlinkenTrotzBearbeitung}"
																	onclick="if (!confirm('#{msgs.warningAdminBeforeLinking}')) return false"
																	rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and item.imageFolderInUse}">
																	<i class="fa fa-cloud-download margin-right-10" />
																	<h:outputText value="#{msgs.imHomeVerzeichnisVerlinkenTrotzBearbeitung}" />
																	<x:updateActionListener property="#{ProzessverwaltungForm.myProzess}" value="#{item}" />
																</h:commandLink>
															</li>
															<li>
																<!-- Upload-Schaltknopf -->
																<h:commandLink action="#{ProzessverwaltungForm.UploadFromHome}" id="action18"
																	title="#{msgs.ausHomeverzeichnisEntfernen}"
																	onclick="if (!confirm('#{msgs.ausHomeverzeichnisEntfernen}')) return false"
																	rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen'}">
																	<i class="fa fa-cloud-upload margin-right-10" />
																	<h:outputText value="#{msgs.ausHomeverzeichnisEntfernen}" />
																	<x:updateActionListener property="#{ProzessverwaltungForm.myProzess}" value="#{item}" />
																</h:commandLink>
															</li>
														</h:panelGroup>

														<h:panelGroup
															rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and LoginForm.hasRole('Workflow_Processes_Allow_Download')}">
															<li>
																<!-- XML Export-Schaltknopf -->
																<h:commandLink id="ubid119" action="#{ProzessverwaltungForm.CreateXML}" title="#{msgs.createXML}" onclick="preventDoubleSubmit(this);">
																	<i class="fa fa-floppy-o margin-right-10" />
																	<h:outputText value="#{msgs.createXML}" />
																	<x:updateActionListener property="#{ProzessverwaltungForm.myProzess}" value="#{item}" />
																</h:commandLink>
															</li>
															<li>
																<!-- Docket Export -->
																<h:commandLink id="ubid1119" action="#{ProzessverwaltungForm.downloadDocket}" onclick="preventDoubleSubmit(this);"
																	title="#{msgs.laufzettelDrucken}">
																	<i class="fa fa-print margin-right-10" />
																	<h:outputText value="#{msgs.laufzettelDrucken}" />
																	<x:updateActionListener property="#{ProzessverwaltungForm.myProzess}" value="#{item}" />
																</h:commandLink>

															</li>
															<li>
																<!-- Mets-Export-Schaltknopf -->
																<h:commandLink action="#{ProzessverwaltungForm.ExportMets}" id="action19" title="#{msgs.exportMets}" onclick="preventDoubleSubmit(this);"
																	rendered="#{item.displayMETSButton}">
																	<i class="fa fa-floppy-o margin-right-10" />
																	<h:outputText value="#{msgs.exportMets}" />
																	<x:updateActionListener property="#{ProzessverwaltungForm.myProzess}" value="#{item}" />
																</h:commandLink>
															</li>
															<li>
																<!-- PDF-Export-Schaltknopf -->
																<h:commandLink action="#{ProzessverwaltungForm.ExportPdf}" id="action20" title="#{msgs.exportPdf}" onclick="preventDoubleSubmit(this);"
																	rendered="#{item.displayPDFButton}">
																	<i class="fa fa-floppy-o margin-right-10" />
																	<h:outputText value="#{msgs.exportPdf}" />
																	<x:updateActionListener property="#{ProzessverwaltungForm.myProzess}" value="#{item}" />
																</h:commandLink>
															</li>
														</h:panelGroup>
 
                                                        
													</ul>
												</div>
											</h:panelGroup>
                                        </x:column>

									</x:dataTable>

									<div class="dataTables_info" style="float: left;">
										<!-- Neu-Schaltknopf -->
										<!-- 									 <h:commandLink action="#{ProzessverwaltungForm.Neu}" immediate="true" styleClass="btn btn-primary font-size-s" -->
										<!--                                         rendered="#{LoginForm.hasRole('Workflow_General_Details_Edit') and ProzessverwaltungForm.modusAnzeige!='vorlagen'}" -->
										<!--                                         id="new1"> -->
										<!--                                         <i class="fa fa-plus margin-right-5"></i> -->
										<!--                                         <h:outputText value="#{msgs.einenNeuenProzessAnlegen}" /> -->
										<!--                                     </h:commandLink> -->
										<h:commandLink action="#{ProzessverwaltungForm.NeuVorlage}" immediate="true"
											styleClass="btn btn-primary font-size-s"
											rendered="#{LoginForm.hasRole('Workflow_General_Details_Edit') and ProzessverwaltungForm.modusAnzeige=='vorlagen'}"
											id="new2">
											<i class="fa fa-plus margin-right-5"></i>
											<h:outputText value="#{msgs.eineNeueProzessvorlageAnlegen}" />
										</h:commandLink>
									</div>
									<div class="dataTables_paginate">
										<!-- paginator -->
										<intranda:tablePaginator paginator="#{ProzessverwaltungForm.paginator}" id="navigator" />
										<!-- /paginator -->
									</div>
								</h:form>

							</div>
						</div>
					</div>
				</div>
			</div>

			<h:panelGroup
				rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.paginator.list.size() gt 0}">
				<ui:include src="includes/process/list_action.xhtml" />
				<ui:include src="includes/process/list_count.xhtml" />
				<ui:include src="includes/process/list_statistics.xhtml" />
			</h:panelGroup>

		</c:if>

		<script type="text/javascript">
			window.onload = function() {
				loadImages();

			}
		</script>

	</ui:define>

	<!--  
	<ui:define name="sidebar">
		<h:form id="sidebarform">

			

		</h:form>
	</ui:define>
-->
</ui:composition>