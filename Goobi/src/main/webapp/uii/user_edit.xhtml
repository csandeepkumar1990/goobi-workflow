<ui:composition
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:f="http://xmlns.jcp.org/jsf/core"
  template="/uii/templatePG/templatePG.html"
  xmlns:o="http://omnifaces.org/ui"
  xmlns:of="http://omnifaces.org/functions"
  xmlns:x="http://myfaces.apache.org/tomahawk"
  xmlns:intranda="http://xmlns.jcp.org/jsf/composite/compositesPG"
  xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
  xmlns:jsf="http://xmlns.jcp.org/jsf">

<ui:param
  name="myPageTitle"
  value="#{BenutzerverwaltungForm.myClass.id == null?msgs.neuenBenutzerAnlegen:msgs.benutzerBearbeiten}" />

  <!-- BREADCRUMBS -->
  <ui:define name="breadcrumb">
    <intranda:breadcrumb
      id="index"
      label="#{DashboardForm.plugin==null?msgs.startseite:msgs.dashboard}"
      action="index" navId="a0" />
    <intranda:breadcrumb
      id="userAll"
      label="#{msgs.benutzerverwaltung}"
      action="#{BenutzerverwaltungForm.paginator.returnToPreviousPage}" />
    <intranda:breadcrumb
      id="userEdit"
      label="#{myPageTitle}"
      action="user_edit" noSeparator="#{true}" />
  </ui:define>

  <ui:define name="info">
  </ui:define>

  <ui:define name="content">

    <script type="text/javascript">
      window.onload = function() {
        document.getElementById('nachname').focus();
      }
    </script>

    <h:form
      id="myform"
      styleClass="form-horizontal form-bordered view-users"
      onkeypress="submitOnEnter(event);"
      rendered="#{LoginForm.hasRole('Admin_Users')}">


      <div class="row" role="main">
        <div class="col-12 col-md-12">

          <intranda:box
            boxType="action"
            scope="form-box"
            boxTitle="false"
            padding="false"
            >

            <!-- TITLE BAR -->
            <intranda:boxTitle
              title="#{myPageTitle}"
              icon="fa-edit"
              >
              <ul class="tabs">
                <li class="tab #{BenutzerverwaltungForm.displayMode eq ''?'active':''}">
                  <h:commandLink
                    id="tab1"
                    styleClass="tab__link"
                    action="#{NavigationForm.Reload}"
                    value="#{msgs.details}">
                    <f:setPropertyActionListener
                      target="#{BenutzerverwaltungForm.displayMode}"
                      value="" />
                    <f:ajax
                      render=":myform"
                      execute=":myform" />
                  </h:commandLink>
                </li>
                <li class="tab #{BenutzerverwaltungForm.displayMode eq 'tab2'?'active':''}">
                  <h:commandLink
                    id="tab2"
                    styleClass="tab__link"
                    action="#{NavigationForm.Reload}"
                    value="#{msgs.benutzergruppen}"
                    disabled="#{BenutzerverwaltungForm.myClass.id == null}">
                    <f:setPropertyActionListener
                      target="#{BenutzerverwaltungForm.displayMode}"
                      value="tab2" />
                    <f:ajax
                      render=":myform"
                      execute=":myform" />
                  </h:commandLink>
                </li>
                <li class="tab #{BenutzerverwaltungForm.displayMode eq 'tab3'?'active':''}">
                <h:commandLink
                  id="tab3"
                  styleClass="tab__link"
                  action="#{NavigationForm.Reload}"
                  value="#{msgs.projekte}"
                  disabled="#{BenutzerverwaltungForm.myClass.id == null}">
                <f:setPropertyActionListener
                  target="#{BenutzerverwaltungForm.displayMode}"
                  value="tab3" />
                <f:ajax render=":myform"
                        execute=":myform" />
                </h:commandLink>
              </li>
            </ul>
          </intranda:boxTitle>


          <!-- CONTENT -->
          <div class="tab-content">

            <!-- TAB 1 -->
            <div class="#{BenutzerverwaltungForm.displayMode eq ''?'tab-pane active':'tab-pane'}">

              <intranda:formInputText
                id="lastname"
                label="#{msgs.nachname}"
                field="#{BenutzerverwaltungForm.myClass.nachname}"
                help="#{msgs.helpNachname}"
                name="nachname"
                fieldStyle="row" />

              <intranda:formInputText
                id="firstname"
                label="#{msgs.vorname}"
                field="#{BenutzerverwaltungForm.myClass.vorname}"
                help="#{msgs.helpVorname}"
                name="vorname"
                fieldStyle="row" />

              <intranda:formInputText
              id="location"
              label="#{msgs.standort}"
              field="#{BenutzerverwaltungForm.myClass.standort}"
              help="#{msgs.helpStandort}"
              name="standort"
              fieldStyle="row" />

            <intranda:formInputDropDown
              id="institution"
              rendered="#{BenutzerverwaltungForm.institutionsAsSelectList.size()>1}"
              label="#{msgs.institution}"
              field="#{BenutzerverwaltungForm.currentInstitutionID}"
              help="#{msgs.helpUserInstitution}"
              name="institutionName"
              selectItems="#{BenutzerverwaltungForm.institutionsAsSelectList}"
              required="true" />

              <div class="row">
                <div
                  class="col-12 col-md-3 form__label">
                  <h:outputLabel
                    for="loginAs"
                    value="#{msgs.login}">
                  <i
                    class="fa fa-asterisk"
                    title="#{msgs.requiredField}"
                    data-toggle="tooltip" />
                  </h:outputLabel>
                </div>
                <div class="col-12 col-md-9">
                  <x:inputText
                    id="loginAs"
                    forceId="true"
                    styleClass="form-control"
                    value="#{BenutzerverwaltungForm.myClass.login}"
                    required="true"
                    readonly="false"
                    validatorMessage="#{msgs.loginWrongCharacter}">
                  <f:validateRegex
                    pattern="[a-z0-9\._-]+" />
                  </x:inputText>
                  <h:message
                    for="loginAs"
                    showDetail="true"
                    styleClass="help-inline font-danger" />
                  <intranda:formHelp content="#{msgs.helpLogin}" />
                </div>
              </div>

              <div class="row">
                <div
                  class="col-12 col-md-3 ">

                  <h:outputLabel
                    styleClass="form__label"
                    for="ldapGruppe"
                    value="#{msgs.user_edit_loginType}">
                  <i
                    class="fa fa-asterisk form__required"
                    title="#{msgs.requiredField}"
                    data-toggle="tooltip" />
                  </h:outputLabel>
                </div>
                <div class="col-12 col-md-9">
                  <h:panelGroup
                    rendered="#{cc.attrs.onevent == null}">
                  <h:selectOneMenu
                    id="ldapGruppe"
                    styleClass="form-select"
                    value="#{BenutzerverwaltungForm.ldapGruppeAuswahl}"
                    validator="#{BenutzerverwaltungForm.validateAuthenticationSelection}">
                  <f:ajax
                    event="change"
                    render="myform:loginTypeArea" />
                  <f:selectItems
                    value="#{BenutzerverwaltungForm.ldapGruppeAuswahlListe}"
                    var="var"
                    itemLabel="#{var.itemLabel}"
                    itemValue="#{var.itemValue}" />
                  </h:selectOneMenu>
                  </h:panelGroup>
                  <h:message
                    for="ldapGruppe"
                    showDetail="true"
                    styleClass="help-inline font-danger" />
                  <intranda:formHelp content="#{msgs.helpLdapGruppe}" />
                </div>
              </div>

              <h:panelGroup id="loginTypeArea">
              <h:panelGroup
                rendered="#{BenutzerverwaltungForm.myClass.ldapGruppe.authenticationType == 'ldap'}">
              <intranda:formInputText
                id="ldapname"
                label="#{msgs.ldaplogin}"
                required="false"
                field="#{BenutzerverwaltungForm.myClass.ldaplogin}"
                help="#{msgs.helpLdaplogin}"
                name="ldaplogin" />
              </h:panelGroup>
              <h:panelGroup
                rendered="#{BenutzerverwaltungForm.myClass.id == null and BenutzerverwaltungForm.myClass.ldapGruppe.authenticationType != 'openid' and (BenutzerverwaltungForm.myClass.ldapGruppe.authenticationType != 'ldap' or not BenutzerverwaltungForm.myClass.ldapGruppe.readonly)}"
                >
              <intranda:formInputSecretText
                id="password"
                label="#{msgs.passwort}"
                required="#{not BenutzerverwaltungForm.myClass.ldapGruppe.readonly}"
                displayAsRequired="#{not BenutzerverwaltungForm.myClass.ldapGruppe.readonly}"
                field="#{BenutzerverwaltungForm.myClass.passwort}"
                help="#{msgs.helpPasswort}"
                name="passwordName" />
              </h:panelGroup>
              <h:panelGroup
                id="ssoIdArea"
                rendered="#{BenutzerverwaltungForm.myClass.ldapGruppe.authenticationType == 'openid'}">
              <intranda:formInputText
                id="ssoId"
                label="#{msgs.user_edit_ssoId}"
                field="#{BenutzerverwaltungForm.myClass.ssoId}"
                help="#{msgs.helpSsoId}"
                required="false"
                name="email"
                fieldStyle="row" />
              </h:panelGroup>
              </h:panelGroup>

              <intranda:formInputText
                classLeft="col-12 col-md-3"
                id="email"
                label="#{msgs.email}"
                field="#{BenutzerverwaltungForm.myClass.email}"
                help="#{msgs.helpEmail}"
                required="false"
                name="emailName" />

              <intranda:formInputText
                classLeft="col-12 col-md-3"
                id="metadataLanguage"
                label="#{msgs.spracheFuerMetadaten}"
                field="#{BenutzerverwaltungForm.myClass.metadatenSprache}"
                help="#{msgs.helpSpracheFuerMetadaten}"
                name="metadatenSprache"
                required="false" />

              <intranda:formInputDropDown
                classLeft="col-12 col-md-3"
                id="dashboard"
                label="#{msgs.dashboard}"
                field="#{BenutzerverwaltungForm.myClass.dashboardPlugin}"
                help="#{msgs.helpUserDashboard}"
                name="dashboardName"
                selectItems="#{BenutzerverwaltungForm.myClass.availableDashboards}"
                />

              <ui:fragment
                rendered="#{LoginForm.myBenutzer.superAdmin}">
              <intranda:formInputCheckBox
                classLeft="col-12 col-md-3"
                id="superadmin"
                label="#{msgs.authentication_isSuperAdmin}"
                field="#{BenutzerverwaltungForm.myClass.superAdmin}"
                help="#{msgs.helpAuthentication_isSuperAdmin}"
                name="superadmin_name" />
              </ui:fragment>

              <intranda:formInputCheckBox
                classLeft="col-12 col-md-3"
                id="isActive"
                label="#{msgs.istAktiv}"
                field="#{BenutzerverwaltungForm.myClass.active}"
                help="#{msgs.helpIstAktiv}"
                name="istAktiv" />

              <intranda:formInputCheckBox
                classLeft="col-12 col-md-3"
                id="usemassdownload"
                label="#{msgs.massendownload}"
                field="#{BenutzerverwaltungForm.myClass.mitMassendownload}"
                help="#{msgs.helpMassendownload}"
                name="massendownload"
                style="border-bottom: 1px solid #DDDDDD;" />
          </div>

          <!-- TAB 2 -->
          <div
            class="#{BenutzerverwaltungForm.displayMode eq 'tab2' or BenutzerverwaltungForm.displayMode eq 'usergroup'?'tab-pane active':'tab-pane'}">

            <!-- ===================== User groups ====================== -->

            <div class="row"
                 style="border-bottom: 1px solid #DDDDDD;">

              <h:outputLabel
                styleClass="col-12 col-md-3 form__label"
                value="#{msgs.benutzergruppen}" />

              <div class="col-12 col-md-9">

                <h:panelGroup
                  rendered="#{BenutzerverwaltungForm.displayMode eq 'usergroup'}">

                    <intranda:box
                      boxType="blank"
                      scope="view-users__box--usergroup-1"
                      title="#{msgs.benutzergruppen}"
                      icon="fa-table"
                      padding="false"
                    >

                    <div class="dataTables__wrapper">

                      <x:dataTable
                        id="newgroups"
                        styleClass="table table-hover table-nomargin dataTable table-bordered responsive"
                        var="item"
                        value="#{BenutzerverwaltungForm.usergroupPaginator.list}">

                      <x:column styleClass="table__actions">

                      <!-- Hinzufügen-Schaltknopf -->
                      <button
                        jsf:id="add"
                        class="btn btn-primary margin-right-10"
                        title="#{msgs.uebernehmen}"
                        jsf:rel="tooltip"
                        jsf:action="#{BenutzerverwaltungForm.ZuGruppeHinzufuegen}">
                        <i
                          class="fa fa-plus"></i>
                        <f:param
                          name="ID"
                          value="#{item.id}" />
                        <f:setPropertyActionListener
                          target="#{BenutzerverwaltungForm.displayMode}"
                          value="tab2" />
                        <f:ajax
                          render=":myform" />
                      </button>
                      <h:outputText
                        value="#{item.titel}" />
                      </x:column>
                      <x:column>
                      <h:outputText
                        value="#{item.institution.shortName}" />
                      </x:column>
                      </x:dataTable>

                      <div
                        class="form__actions">
                        <!-- Cancel-Schaltknopf -->
                        <button
                          jsf:id="cancel"
                          class="btn btn-blank"
                          jsf:action="#{NavigationForm.Reload}">
                          <h:outputText
                            value="#{msgs.abbrechen}" />
                          <f:setPropertyActionListener
                            target="#{BenutzerverwaltungForm.displayMode}"
                            value="tab2" />
                          <f:ajax
                            render=":myform" />
                        </button>
                      </div>
                      <div class="dataTables__paginate">
                        <!-- paginator -->
                        <intranda:tablePaginator2
                          id="groups"
                          paginator="#{BenutzerverwaltungForm.usergroupPaginator}" />
                        <!-- /paginator -->
                      </div>
                    </div> <!-- dataTables wrapper end -->

                    </intranda:box> <!-- nested box end -->

                  </h:panelGroup>


                  <h:panelGroup rendered="#{BenutzerverwaltungForm.displayMode ne 'usergroup'}">

                  <!-- Nested box -->
                    <intranda:box
                      boxType="blank"
                      scope="view-users__box--usergroup-2"
                      title="#{msgs.benutzergruppen}"
                      icon="fa-table"
                      padding="false"
                    >

                      <div class="dataTables_wrapper">

                        <x:dataTable
                          id="currentGroups"
                          styleClass="table table-hover table-nomargin dataTable table-bordered responsive"
                          var="item"
                          value="#{BenutzerverwaltungForm.myClass.benutzergruppen}">

                          <h:column>
                            <h:outputText value="#{item.titel}" />
                          </h:column>
                          <x:column styleClass="table__actions">
                            <h:outputText value="#{item.institution.shortName}" />
                            <!-- Löschen-Schaltknopf -->
                            <button
                              jsf:id="deleteFromGroup"
                              class="btn btn-danger pull-right"
                              title="#{msgs.ausGruppeLoeschen}"
                              jsf:rel="tooltip"
                              jsf:action="#{BenutzerverwaltungForm.AusGruppeLoeschen}">
                              <i class="fa fa-trash-o"></i>
                              <f:param name="ID" value="#{item.id}" />
                              <f:ajax render=":myform" />
                            </button>
                          </x:column>
                        </x:dataTable>

                        <div class="box__actions">
                          <!-- Neu-Schaltknopf -->
                          <button
                            jsf:id="addGroup"
                            jsf:rendered="#{BenutzerverwaltungForm.unsubscribedGroupsExist}"
                            class="btn btn-primary-400 me-auto"
                            jsf:action="#{BenutzergruppenForm.FilterKeinMitZurueck}"
                            jsf:immediate="true">
                            <i class="fa fa-plus"></i>
                            <span><h:outputText value="#{msgs.benutzergruppenHinzufuegen}" /></span>
                            <f:setPropertyActionListener
                              target="#{BenutzerverwaltungForm.displayMode}"
                              value="usergroup" />
                            <f:ajax render=":myform" />
                          </button>
                        </div>

                      </div> <!-- dataTables wrapper end -->
                    </intranda:box>

                    <intranda:formHelp content="#{msgs.helpBenutzergruppen}" />
                  </h:panelGroup>

              </div> <!-- row user groups end -->
            </div>

          </div> <!-- TAB 2 end -->

          <!-- TAB 3 -->
          <div id="t9"
               class="#{BenutzerverwaltungForm.displayMode eq 'tab3' or BenutzerverwaltungForm.displayMode eq 'project'?'tab-pane active':'tab-pane'}">

            <!-- ===================== Projects ====================== -->
            <div
              class="row"
              style="border-bottom: 1px solid #DDDDDD;">

              <h:outputLabel
                styleClass="col-12 col-md-3 form__label"
                value="#{msgs.projekte}" />

              <div class="col-12 col-md-9">

                <h:panelGroup
                  rendered="#{BenutzerverwaltungForm.displayMode eq 'project'}">

                <!-- Nested Box -->
                <intranda:box
                  boxType="blank"
                  scope="view-users__box--project-1"
                  title="#{msgs.projekte}"
                  icon="fa-table"
                  padding="false"
                >

                    <div
                      class="dataTables_wrapper">

                      <x:dataTable
                        id="newprojects"
                        styleClass="table"
                        var="item"
                        value="#{BenutzerverwaltungForm.projectPaginator.list}">

                      <x:column styleClass="table__actions">
                      <!-- Hinzufügen-Schaltknopf -->
                      <button
                        jsf:id="addProject"
                        class="btn btn-primary-400"
                        title="#{msgs.uebernehmen}"
                        jsf:rel="tooltip"
                        jsf:action="#{BenutzerverwaltungForm.ZuProjektHinzufuegen}">
                        <i class="fa fa-plus"></i>
                        <f:param
                          name="ID"
                          value="#{item.id}" />
                        <f:setPropertyActionListener
                          target="#{BenutzerverwaltungForm.displayMode}"
                          value="tab3" />
                        <f:ajax
                          render=":myform" />
                      </button>
                      <h:outputText
                        value="#{item.titel}" />
                      </x:column>
                      <x:column>
                      <h:outputText
                        value="#{item.institution.shortName}" />
                      </x:column>
                      </x:dataTable>

                      <div
                        class="box__actions">
                        <!-- Cancel-Schaltknopf -->
                        <a
                          jsf:id="cancelProject"
                          class="btn btn-blank"
                          jsf:action="#{NavigationForm.Reload}">
                          <span><h:outputText value="#{msgs.abbrechen}" /></span>
                          <f:setPropertyActionListener
                            target="#{BenutzerverwaltungForm.displayMode}"
                            value="tab3" />
                          <f:ajax
                            render=":myform" />
                        </a>
                      </div>
                      <div
                        class="dataTables_paginate">
                        <!-- paginator -->
                        <intranda:tablePaginator
                          id="projects"
                          paginator="#{BenutzerverwaltungForm.projectPaginator}" />
                        <!-- /paginator -->
                      </div>

                </div>
              </intranda:box>

              </h:panelGroup>


              <h:panelGroup rendered="#{BenutzerverwaltungForm.displayMode ne 'project'}">

                <!-- Nested box -->
                <intranda:box
                  boxType="blank"
                  scope="view-users__box--project-2"
                  title="#{msgs.projekte}"
                  icon="fa-table"
                  padding="false"
                >

                  <div
                    class="dataTables_wrapper">

                    <x:dataTable
                      id="currentProjects"
                      styleClass="table table-hover table-nomargin dataTable table-bordered responsive"
                      var="item"
                      value="#{BenutzerverwaltungForm.myClass.projekte}">

                    <h:column>
                    <h:outputText
                      value="#{item.titel}" />
                    </h:column>
                    <x:column styleClass="table__actions">
                    <h:outputText
                      value="#{item.institution.shortName}" />
                    <!-- Löschen-Schaltknopf -->
                    <button
                      jsf:id="deleteFromProject"
                      class="btn btn-danger pull-right"
                      title="#{msgs.ausProjektLoeschen}"
                      jsf:rel="tooltip"
                      jsf:action="#{BenutzerverwaltungForm.AusProjektLoeschen}">
                      <i class="fa fa-trash-o"></i>
                      <f:param
                        name="ID"
                        value="#{item.id}" />
                      <f:ajax
                        render=":myform" />
                    </button>
                    </x:column>
                    </x:dataTable>

                    <div class="box__actions">
                      <!-- Neu-Schaltknopf -->
                      <button
                        jsf:id="addToProject"
                        jsf:rendered="#{BenutzerverwaltungForm.unsubscribedProjectsExist}"
                        class="btn btn-primary me-auto"
                        jsf:action="#{ProjekteForm.FilterKeinMitZurueck}"
                        jsf:immediate="true">
                        <i class="fa fa-plus me-auto"></i>
                        <span><h:outputText value="#{msgs.projektHinzufuegen}" /></span>
                        <f:setPropertyActionListener
                          target="#{BenutzerverwaltungForm.displayMode}"
                          value="project" />
                        <f:ajax render=":myform" />
                      </button>
                    </div>

                  </div>
                  </intranda:box>
                  <intranda:formHelp content="#{msgs.helpProjekte}" />
                </h:panelGroup>

              </div> <!-- col-12 col-md-9 end -->
            </div>
          </div> <!-- TAB 3 end -->
        </div>

          <h:panelGroup
            rendered="#{BenutzerverwaltungForm.displayMode ne 'usergroup' and BenutzerverwaltungForm.displayMode ne 'project'  and BenutzerverwaltungForm.displayMode ne 'institution'}">

          <div class="form-actions">

            <h:panelGroup
              rendered="#{BenutzerverwaltungForm.myClass.id == null}">
            <button
              class="btn btn-success submitOnEnter pull-right font-size-s margin-bottom-most"
              jsf:id="absenden2"
              type="submit"
              jsf:action="#{BenutzerverwaltungForm.createUser}">
              <i class="fa fa-save margin-right-5"></i>
              <span><h:outputText value="#{msgs.createUser}" /></span>
            </button>

            <!-- Cancel -->
            <h:link
              id="cancelEdition2"
              styleClass="btn btn-blank"
              outcome="user_all"
              value="#{msgs.abbrechen}" />


          </h:panelGroup>


          <h:panelGroup
            rendered="#{BenutzerverwaltungForm.myClass.id != null}">

            <!-- Cancel -->
            <a
              jsf:id="cancelEdition"
              class="btn btn-blank"
              jsf:immediate="true"
              jsf:action="#{BenutzerverwaltungForm.cancelEdit}">
              <h:outputText
                value="#{msgs.abbrechen}" />
            </a>

            <!-- Save -->
            <button
              class="btn btn-success submitOnEnter"
              jsf:id="absenden"
              type="submit"
              jsf:action="#{BenutzerverwaltungForm.Speichern}">
              <i class="fa fa-save"></i>
              <span><h:outputText value="#{msgs.speichern}" /></span>
            </button>

            <!-- Delete -->
            <button
              jsf:id="deleteUser"
              class="btn btn-hot trigger-delete"
              onclick="if (!confirm('#{msgs.sollDieserEintragWirklichGeloeschtWerden}')) return false"
              jsf:action="#{BenutzerverwaltungForm.Loeschen}">
              <i class="fa fa-trash-o"></i>
              <span><h:outputText value="#{msgs.loeschen}" /></span>
            </button>

          </h:panelGroup>
          </div>
          </h:panelGroup>


        </intranda:box>
    </div> <!-- col end -->
  </div> <!-- row end -->

  </h:form>
</ui:define>
</ui:composition>
