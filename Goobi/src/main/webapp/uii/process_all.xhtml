<ui:composition
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:of="http://omnifaces.org/functions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="/uii/templatePG/templatePG.html"
	xmlns:x="http://myfaces.apache.org/tomahawk"
	xmlns:intranda="http://xmlns.jcp.org/jsf/composite/compositesPG"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:jsf="http://xmlns.jcp.org/jsf">

	<ui:param
		name="myPageTitle"
		value="#{ProzessverwaltungForm.modusAnzeige=='aktuell'?msgs.aktuelleProzesse:msgs.prozessvorlagen}" />

	<ui:define name="title">
		<h:outputText value="#{myPageTitle}" />
	</ui:define>

	<ui:define name="breadcrumb">
		<intranda:breadcrumb
			id="id2"
			label="#{DashboardForm.plugin==null?msgs.startseite:msgs.dashboard}"
			action="index"
			navId="a0" />
		<intranda:breadcrumb
			id="processAll"
			label="#{myPageTitle}"
			action="process_all"
			noSeparator="#{true}" />
	</ui:define>

	<ui:define name="info">
	</ui:define>

	<ui:define name="content">
		<link
			rel="stylesheet"
			href="template/css/codemirror/codemirror.css?v=#{HelperForm.buildVersion}" />
		<script
			type="text/javascript"
			src="template/js/codemirror/codemirror.js?v=#{HelperForm.buildVersion}" />
		<script
			src="template/js/codemirror/mode/yaml/yaml.js?v=#{HelperForm.buildVersion}"></script>

		<style>
.CodeMirror {
	border: 1px solid #ddd;
	heigth: 50px;
}
</style>

		<!--
	    <script type="text/javascript">
        	function switchExpanded(id){
        		console.log("called by: "+id);
				var x = document.getElementById(id).getAttribute("aria-expanded");
				console.log(x)
				if (x == "true"){
					x = "false"
				} else {
					x = "true"
				}
				document.getElementById(id).setAttribute("aria-expanded", x);
        	}
        </script>
        -->


		<main id="processAll">
			<c:if
				test="#{LoginForm.hasRole('Workflow_Processes') or LoginForm.hasRole('Workflow_ProcessTemplates')}">

				<div class="row">
					<div class="col-sm-12">

						<intranda:box
							id="processAllProcessesBox"
							boxType="primary"
							icon="fa-tasks"
							title="#{myPageTitle}">

							<div class="gw-table gw-table-fixed">

								<h:form id="searchform">

									<div class="gw-table__search">
										<div class="gw-table__search__length">
											<button
												class="btn btn-blank"
												jsf:action="#{ProzessverwaltungForm.generateFilterWithIdentfiers}"
												data-bs-toggle="tooltip"
												title="#{msgs.process_generateFilterQueryForHits}">
												<i class="fa fa-filter" />
												<span>
													<h:outputText
														value="#{msgs.treffer}: #{ProzessverwaltungForm.paginator.totalResults}" />
												</span>
											</button>
										</div>

										<div class="gw-table__filters">
											<ui:include
												src="templatePG/includes/process/list_filterAndDisplay.xhtml" />
											<x:aliasBeansScope>
												<x:aliasBean
													alias="#{Form}"
													value="#{ProzessverwaltungForm}" />
												<x:aliasBean
													alias="#{label}"
													value="#{ProzessverwaltungForm.modusAnzeige=='aktuell'?msgs.filterProcesses:msgs.filterProcessTemplates}" />
												<f:subview id="sub1">
													<ui:include
														src="templatePG/includes/task/list_searchAndSave.xhtml" />
												</f:subview>
											</x:aliasBeansScope>
										</div>

									</div>
									<!--/.gw-table__search-->

								</h:form>
								<h:form id="myform">

									<!-- +++++++++++++++++  Display as grid ++++++++++++++++++++++++ -->
									<h:panelGroup
										rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['gridview']}">

										<ui:include src="includes/process/list_grid.xhtml" />

									</h:panelGroup>

									<!-- +++++++++++++++++  Display as table ++++++++++++++++++++++++ -->

									<div class="gw-table__wrapper">
										<table
											role="grid"
											id="processTable"
											class="table table-hover table-nomargin dataTable table-bordered responsive"
											jsf:rendered="#{ProzessverwaltungForm.modusAnzeige=='vorlagen' or not ProzessverwaltungForm.anzeigeAnpassen['gridview']}">

											<!-- ### Columnheader row ### -->
											<thead>
												<tr role="row">
													<!-- Selection Boxes -->
													<th
														class=" header__selection"
														jsf:rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['selectionBoxes']}">
														<div class="d-flex">

															<h:outputText value="#{msgs.auswahl2}" />

															<button
																jsf:action="#{ProzessverwaltungForm.SelectionAll}"
																jsf:id="selectall"
																title="#{msgs.alleAuswaehlen}"
																class="button-link">
																<i class="fa fa-check-square-o font-black margin-left-5" />
															</button>
															<button
																jsf:action="#{ProzessverwaltungForm.SelectionNone}"
																jsf:id="selectnone"
																title="#{msgs.auswahlEntfernen}"
																class="button-link">
																<i class="fa fa-square-o font-black margin-left-5" />
															</button>

														</div>
													</th>

													<!-- Process Id -->
													<intranda:columnheader
														addClass=" header__id"
														name="id"
														form="#{ProzessverwaltungForm}"
														value="#{msgs.id}"
														rendered="#{ProzessverwaltungForm.anzeigeAnpassen['processId']}"
														ajaxRender="processAllProcessesBox:myform"
														reverseOrder="true" />
													<!-- thumbnail -->
													<intranda:columnheader
														addClass="header__thumbnail"
														value="#{msgs.thumbnail}"
														rendered="#{ProzessverwaltungForm.anzeigeAnpassen['thumbnail'] and ProzessverwaltungForm.modusAnzeige!='vorlagen'}"
														sortable="false" />
													<!-- Embedded Metadata -->
													<intranda:columnheader
														addClass=" header__embedded-metadata"
														value="#{msgs.metadata}"
														rendered="#{ProzessverwaltungForm.anzeigeAnpassen['metadatadetails'] and ProzessverwaltungForm.modusAnzeige!='vorlagen'}"
														sortable="false" />
													<!-- Batch Id -->
													<intranda:columnheader
														addClass=" header__batch-id"
														name="batch"
														form="#{ProzessverwaltungForm}"
														value="#{msgs.batch}"
														rendered="#{ProzessverwaltungForm.anzeigeAnpassen['batchId'] and ProzessverwaltungForm.modusAnzeige!='vorlagen'}"
														ajaxRender="processAllProcessesBox:myform" />
													<!-- Alle Schritte Auflisten -->
													<intranda:columnheader
														addClass=" header__title"
														name="titel"
														form="#{ProzessverwaltungForm}"
														value="#{ProzessverwaltungForm.modusAnzeige=='aktuell'?msgs.prozessTitel:msgs.titel}"
														rendered="true"
														ajaxRender="processAllProcessesBox:myform"
														id="ajaxcolumn" />
													<!-- Costum Columns -->
													<c:forEach
														items="#{LoginForm.listOfCustomColumns}"
														var="var">
														<intranda:columnheader
															addClass="width80"
															value="#{msgs[fn:substring(var, fn:indexOf(var,'.') lt 0 ? 1 : fn:indexOf(var,'.') + 1, var.length() - fn.indexOf(var,'.') - 1)]}"
															sortable="false" />
														<!-- rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen'}" -->
													</c:forEach>
													<!-- Vorgangsdatum -->
													<intranda:columnheader
														addClass=""
														name="vorgangsdatum"
														form="#{ProzessverwaltungForm}"
														value="#{msgs.vorgangsdatum}"
														rendered="#{ProzessverwaltungForm.anzeigeAnpassen['processDate']}"
														ajaxRender="processAllProcessesBox:myform" />
													<!-- Ruleset -->
													<intranda:columnheader
														addClass=" header__ruleset"
														value="#{msgs.regelsatz}"
														rendered="#{ProzessverwaltungForm.anzeigeAnpassen['processRuleset']}"
														sortable="false" />
													<!-- Status -->
													<intranda:columnheader
														addClass="header__status"
														name="fortschritt"
														form="#{ProzessverwaltungForm}"
														value="#{msgs.status}"
														ajaxRender="processAllProcessesBox:myform" />
													<!-- . -->
													<intranda:columnheader
														addClass=" #{item.getProjekt().projectIsArchived?'font-status-deactivated':'font-black'}"
														name="projekt"
														form="#{ProzessverwaltungForm}"
														value="#{msgs.projekt}"
														ajaxRender="processAllProcessesBox:myform" />
													<!-- .. -->
													<intranda:columnheader
														addClass=""
														name="institution"
														form="#{ProzessverwaltungForm}"
														value="#{msgs.institution}"
														rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['institution']}"
														ajaxRender="processAllProcessesBox:myform" />
													<!-- Lockings -->
													<intranda:columnheader
														rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['lockings']}"
														addClass=" header__lockings"
														name="sperrungen"
														form="#{ProzessverwaltungForm}"
														value="#{msgs.sperrungen}"
														ajaxRender="processAllProcessesBox:myform" />
													<!-- .... -->
													<intranda:columnheader
														addClass=""
														value="#{msgs.lastStatusUpdate}"
														rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['editionDate']}"
														sortable="false" />
													<!-- ..... -->
													<intranda:columnheader
														addClass=""
														value="#{msgs.userLastStatusUpdate}"
														rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['editionUser']}"
														sortable="false" />
													<!-- ...... -->
													<intranda:columnheader
														addClass=""
														value="#{msgs.taskLastStatusUpdate}"
														rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['editionTask']}"
														sortable="false" />
													<!-- swapped out -->
													<intranda:columnheader
														addClass=" header__swapped"
														value="#{msgs.ausgelagert}"
														rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['swappedOut']}"
														sortable="false" />

													<!-- number of images -->
													<intranda:columnheader
														rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['numberOfImages']}"
														value="#{msgs.NumberOfImages}"
														addClass=" header__number-of-imgs"
														name="numberOfImages"
														form="#{ProzessverwaltungForm}"
														ajaxRender="processAllProcessesBox:myform" />
													<!-- Buttons -->
													<intranda:columnheader
														addClass="header__buttons"
														value="#{msgs.auswahl}"
														sortable="false" />
												</tr>
											</thead>



											<ui:repeat
												var="item"
												value="#{ProzessverwaltungForm.paginator.list}"
												varStatus="status">
												<tr role="row">
													<!-- Selection Boxes -->
													<td
														class=" width120"
														jsf:rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['selectionBoxes']}">
														<button
															jsf:id="selected"
															aria-label="#{msgs.auswahl2}"
															class="btn btn-blank">
															<i
																class="#{item.selected?'fa fa-check-square-o':'fa fa-square-o'}" />
															<f:setPropertyActionListener
																target="#{item.selected}"
																value="#{item.selected?false:true}" />
															<f:ajax render="processAllProcessesBox:myform" />
														</button>
													</td>
													<!-- Process Id -->
													<td
														jsf:rendered="#{ProzessverwaltungForm.anzeigeAnpassen['processId']}"
														class="wb-normal">
														<h:outputText value="#{item.id}" />
													</td>
													<!-- thumbnail -->
													<td
														jsf:rendered="#{ProzessverwaltungForm.anzeigeAnpassen['thumbnail'] and ProzessverwaltungForm.modusAnzeige!='vorlagen'}">
														<canvas
															class="thumb-canvas"
															style="width: 150px;"
															data-image_small="#{item.getRepresentativeImage(250)}"
															data-image_large="#{item.getRepresentativeImage(750)}"
															id="thumbnail-#{item.id}">
                                            </canvas>
													</td>

													<!-- Embedded Metadata -->
													<td
														jsf:rendered="#{ProzessverwaltungForm.anzeigeAnpassen['metadatadetails'] and ProzessverwaltungForm.modusAnzeige!='vorlagen'}">
														<table class="metadata-nested-table no-borders">
															<ui:repeat
																var="metadata"
																value="#{item.metadataList}"
																varStatus="metadatastatus"
																id="metadatalist">
																<h:panelGroup
																	rendered="#{metadata.one == 'TitleDocMain'
						                                              or metadata.one == 'Author'
						                                              or metadata.one == 'PlaceOfPublication'
						                                              or metadata.one == 'PublicationYear'
						                                              or metadata.one == 'PublisherName'
						                                              or metadata.one == 'CatalogIDDigital'
						                                              or metadata.one == 'shelfmarksource'}">
																	<tr>
																		<td class="data-key">
																			<h:outputText
																				value="#{msgs['process_grid_'.concat(metadata.one)]}:" />
																		</td>
																		<td>
																			<h:outputText value="#{metadata.two}" />
																		</td>
																	</tr>
																</h:panelGroup>
															</ui:repeat>
														</table>
													</td>

													<!-- Batch id -->
													<td
														class="gw-hyphens-none"
														jsf:rendered="#{ProzessverwaltungForm.anzeigeAnpassen['batchId'] and ProzessverwaltungForm.modusAnzeige!='vorlagen'}">
														<h:outputText
															value="#{item.batch.batchId}"
															rendered="#{item.batch != null}" />
														<h:outputText
															value="(#{item.batch.batchName})"
															rendered="#{item.batch != null and item.batch.batchName != null}" />
													</td>

													<!-- Alle Schritte Auflisten -->
													<td>
														<ui:include
															src="templatePG/includes/ajaxPlusMinusButton.xhtml">
															<ui:param
																name="ajaxRender"
																value="processAllProcessesBox:myform" />
														</ui:include>
														<h:panelGroup rendered="#{item.panelAusgeklappt}">

															<!--
				                                            <div class="box box-small box-color box-bordered">
				                                              <div class="box-title">
				                                                <h3>
				                                                  <i class="fa fa-list"></i> #{msgs.details}
				                                                </h3>
				                                              </div>
				                                              <div class="box-content nopadding">
				                                            -->

															<intranda:box
																boxScope="boxTitleDetails"
																boxType="primary"
																boxSmall="true"
																boxPadding="false"
																icon="fa-list"
																title="#{msgs.details}">

																<div class="gw-table">
																	<div class="gw-table__wrapper">

																		<x:dataTable
																			styleClass="table table-hover table-bordered"
																			id="prozessdetails"
																			var="step"
																			value="#{item.schritteList}">

																			<h:column>
																				<f:facet name="header">
																					<h:outputText value="#{msgs.nr}" />
																				</f:facet>
																				<h:outputText
																					value="#{step.reihenfolge}"
																					styleClass="#{step.bearbeitungsstatusEnum == 'DEACTIVATED'?'font-light':''}" />
																			</h:column>

																			<h:column>
																				<f:facet name="header">
																					<h:outputText
																						value="#{msgs.titel}"
																						style="white-space: normal;" />
																				</f:facet>
																				<div class="d-flex align-items-center">
																					<h:panelGroup rendered="#{step.typAutomatisch}">
																						<i
																							class="fa fa-cogs me-4"
																							title="#{msgs.automatischerSchritt}"
																							data-bs-toggle="tooltip" />
																					</h:panelGroup>
																					<h:panelGroup rendered="#{not step.typAutomatisch}">
																						<i
																							class="fa fa-user-o me-4"
																							title="#{msgs.normalerSchritt}"
																							data-bs-toggle="tooltip" />
																					</h:panelGroup>
																					<h:outputText
																						value="#{step.titelLokalisiert}"
																						title="#{step.titel}"
																						data-bs-toggle="tooltip"
																						style="white-space: normal;"
																						styleClass="#{step.reihenfolge}_id #{step.bearbeitungsstatusEnum == 'DEACTIVATED'?'font-light':''}" />
																				</div>
																			</h:column>

																			<h:column>
																				<f:facet name="header">
																					<h:outputText value="#{msgs.status}" />
																				</f:facet>

																				<ul class="colors small13">
																					<h:panelGroup
																						rendered="#{step.bearbeitungsstatusEnum == 'LOCKED'}">
																						<li
																							class="statusSmall #{(LoginForm.myBenutzer.uiMode=='low_vision'?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																							title="#{msgs.statusGesperrt}"
																							data-bs-toggle="tooltip"
																							rel="tooltip"><h:outputText
																								value="#{step.bearbeitungsstatusEnum.title}"
																								rendered="#{LoginForm.myBenutzer.uiMode=='low_vision'}" /></li>
																					</h:panelGroup>
																					<h:panelGroup
																						rendered="#{step.bearbeitungsstatusEnum == 'OPEN'}">
																						<li
																							class="statusSmall #{(LoginForm.myBenutzer.uiMode=='low_vision'?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																							title="#{msgs.statusOffen}"
																							data-bs-toggle="tooltip"><h:outputText
																								value="#{step.bearbeitungsstatusEnum.title}"
																								rendered="#{LoginForm.myBenutzer.uiMode=='low_vision'}" /></li>
																					</h:panelGroup>

																					<h:panelGroup
																						rendered="#{step.bearbeitungsstatusEnum == 'DONE' and HelperForm.anonymized}">
																						<li
																							class="statusSmall #{(LoginForm.myBenutzer.uiMode=='low_vision'?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																							data-bs-toggle="tooltip"
																							title="#{step.bearbeitungsstatusEnum.title} #{step.editTypeEnum.title}"><h:outputText
																								value="#{step.bearbeitungsstatusEnum.title}"
																								rendered="#{LoginForm.myBenutzer.uiMode=='low_vision'}" /></li>
																					</h:panelGroup>
																					<h:panelGroup
																						rendered="#{step.bearbeitungsstatusEnum == 'INWORK' and HelperForm.anonymized}">
																						<li
																							class="statusSmall #{(LoginForm.myBenutzer.uiMode=='low_vision'?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																							data-bs-toggle="tooltip"
																							title="#{step.bearbeitungsstatusEnum.title}: #{step.editTypeEnum.title}"><h:outputText
																								value="#{step.bearbeitungsstatusEnum.title}"
																								rendered="#{LoginForm.myBenutzer.uiMode=='low_vision'}" /></li>
																					</h:panelGroup>

																					<h:panelGroup
																						rendered="#{step.bearbeitungsstatusEnum == 'DONE' and !HelperForm.anonymized}">
																						<li
																							class="statusSmall #{(LoginForm.myBenutzer.uiMode=='low_vision'?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																							data-bs-toggle="tooltip"
																							title="#{step.bearbeitungsstatusEnum.title}: #{step.bearbeitungsbenutzer!=null and step.bearbeitungsbenutzer.id!=0?step.bearbeitungsbenutzer.nachVorname:''} (#{step.bearbeitungszeitpunkt !=null?step.bearbeitungszeitpunktAsFormattedString:''})  - #{step.editTypeEnum.title}"><h:outputText
																								value="#{step.bearbeitungsstatusEnum.title}"
																								rendered="#{LoginForm.myBenutzer.uiMode=='low_vision'}" /></li>
																					</h:panelGroup>
																					<h:panelGroup
																						rendered="#{step.bearbeitungsstatusEnum == 'INWORK' and !HelperForm.anonymized}">
																						<li
																							class="statusSmall #{(LoginForm.myBenutzer.uiMode=='low_vision'?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																							data-bs-toggle="tooltip"
																							title="#{step.bearbeitungsstatusEnum.title}: #{step.bearbeitungsbenutzer!=null and step.bearbeitungsbenutzer.id!=0?step.bearbeitungsbenutzer.nachVorname:''} (#{step.bearbeitungszeitpunkt !=null?step.bearbeitungszeitpunktAsFormattedString:''})  - #{step.editTypeEnum.title}"><h:outputText
																								value="#{step.bearbeitungsstatusEnum.title}"
																								rendered="#{LoginForm.myBenutzer.uiMode=='low_vision'}" /></li>
																					</h:panelGroup>
																					<h:panelGroup
																						rendered="#{step.bearbeitungsstatusEnum == 'ERROR' and !HelperForm.anonymized}">
																						<li
																							class="statusSmall #{(LoginForm.myBenutzer.uiMode=='low_vision'?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																							data-bs-toggle="tooltip"
																							title="#{step.bearbeitungsstatusEnum.title}: #{step.bearbeitungsbenutzer!=null and step.bearbeitungsbenutzer.id!=0?step.bearbeitungsbenutzer.nachVorname:''} (#{step.bearbeitungszeitpunkt !=null?step.bearbeitungszeitpunktAsFormattedString:''})  - #{step.editTypeEnum.title}"><h:outputText
																								value="#{step.bearbeitungsstatusEnum.title}"
																								rendered="#{LoginForm.myBenutzer.uiMode=='low_vision'}" /></li>
																					</h:panelGroup>
																					<h:panelGroup
																						rendered="#{step.bearbeitungsstatusEnum == 'ERROR' and HelperForm.anonymized}">
																						<li
																							class="statusSmall #{(LoginForm.myBenutzer.uiMode=='low_vision'?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																							data-bs-toggle="tooltip"
																							title="#{step.bearbeitungsstatusEnum.title}: #{step.editTypeEnum.title}"><h:outputText
																								value="#{step.bearbeitungsstatusEnum.title}"
																								rendered="#{LoginForm.myBenutzer.uiMode=='low_vision'}" /></li>
																					</h:panelGroup>

																					<h:panelGroup
																						rendered="#{step.bearbeitungsstatusEnum == 'DEACTIVATED'}">
																						<li
																							class="statusSmall #{(LoginForm.myBenutzer.uiMode=='low_vision'?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																							title="#{step.bearbeitungsstatusEnum.title}"
																							data-bs-toggle="tooltip"><h:outputText
																								value="#{step.bearbeitungsstatusEnum.title}"
																								rendered="#{LoginForm.myBenutzer.uiMode=='low_vision'}" /></li>
																					</h:panelGroup>

																					<h:panelGroup
																						rendered="#{step.bearbeitungsstatusEnum == 'INFLIGHT'}">
																						<li
																							class="statusSmall #{(LoginForm.myBenutzer.uiMode=='low_vision'?('easy-read-'):('')).concat(step.bearbeitungsstatusEnum.color)}"
																							title="#{msgs.statusInFlight}"
																							data-bs-toggle="tooltip"><h:outputText
																								value="#{step.bearbeitungsstatusEnum.title}"
																								rendered="#{LoginForm.myBenutzer.uiMode=='low_vision'}" /></li>
																					</h:panelGroup>
																				</ul>

																			</h:column>

																		</x:dataTable>

																	</div>
																	<!--/gw-table-->
																</div>
																<!--/gw-table__wrapper-->

															</intranda:box>

														</h:panelGroup>
													</td>

													<!-- CUSTOM COLUMNS -->
													<c:forEach
														items="#{LoginForm.listOfCustomColumns}"
														var="var">
														<td>
															<h:outputText value="#{item.getReplacedVariable(var)}" />
														</td>
													</c:forEach>

													<!-- PROCESS DATE -->
													<td
														jsf:rendered="#{ProzessverwaltungForm.anzeigeAnpassen['processDate']}">
														<h:outputText value="#{item.erstellungsdatumAsString}">
															<!-- <f:convertDateTime locale="#{SpracheForm.locale}" type="date" dateStyle="medium"/> -->
														</h:outputText>
													</td>

													<!-- RULESET -->
													<td
														jsf:rendered="#{ProzessverwaltungForm.anzeigeAnpassen['processRuleset']}">
														<h:outputText value="#{item.regelsatz.titel}" />
													</td>

													<!-- STATUS -->
													<td>

														<div class="progress__container mt-2">
															<h:panelGroup
																rendered="#{item.fortschritt3 gt 0}"
																data-toggle="tooltip"
																styleClass="progress-bar #{(LoginForm.myBenutzer.uiMode=='low_vision'?('easy-read-progressbar-status-done'):('progress-bar-success'))}"
																style="width: #{item.fortschritt3}%;line-height:15px;"
																pt:role="figure"
																pt:aria-label="#{item.fortschritt3}% #{msgs.statusAbgeschlossen}">
																<h:outputText value="&#160;" />
																<f:passThroughAttribute
																	name="data-bs-trigger"
																	value="hover" />
																<f:passThroughAttribute
																	name="data-bs-container"
																	value="body" />
																<f:passThroughAttribute
																	name="data-bs-toggle"
																	value="popover" />
																<f:passThroughAttribute
																	name="data-bs-placement"
																	value="top" />
																<f:passThroughAttribute
																	name="data-bs-html"
																	value="true" />
																<f:passThroughAttribute
																	name="data-bs-content"
																	value="&lt;b class='font-status-done'&gt;#{msgs.statusAbgeschlossen}:&lt;/b&gt;&lt;br/&gt; #{item.getStepsAsString(3, ', ')}" />
															</h:panelGroup>

															<h:panelGroup
																rendered="#{item.fortschritt2 gt 0}"
																data-toggle="tooltip"
																styleClass="progress-bar #{(LoginForm.myBenutzer.uiMode=='low_vision'?('easy-read-progressbar-status-open'):('progress-bar-warning'))}"
																style="width: #{item.fortschritt2}%;line-height:15px;"
																pt:role="figure"
																pt:aria-label="#{item.fortschritt2}% #{msgs.statusOffen} / #{msgs.statusInBearbeitung}">
																<h:outputText value="&#160;" />
																<f:passThroughAttribute
																	name="data-bs-trigger"
																	value="hover" />
																<f:passThroughAttribute
																	name="data-bs-container"
																	value="body" />
																<f:passThroughAttribute
																	name="data-bs-toggle"
																	value="popover" />
																<f:passThroughAttribute
																	name="data-bs-placement"
																	value="top" />
																<f:passThroughAttribute
																	name="data-bs-html"
																	value="true" />
																<f:passThroughAttribute
																	name="data-bs-content"
																	value="&lt;b class='font-status-open'&gt;#{msgs.statusOffen} / #{msgs.statusInBearbeitung}:&lt;/b&gt;&lt;br/&gt; #{item.getStepsAsString(1, ', ')}#{item.getStepsAsString(1, ', ') ne '' and item.getStepsAsString(2, ', ') ne ''?', ':''} #{item.getStepsAsString(2, ', ')}" />
															</h:panelGroup>

															<h:panelGroup
																rendered="#{item.fortschrittError gt 0}"
																data-toggle="tooltip"
																styleClass="progress-bar #{(LoginForm.myBenutzer.uiMode=='low_vision'?('easy-read-progressbar-status-error'):('progress-bar-danger progressbar-status-error'))} "
																style="width: #{item.fortschrittError}%;line-height:15px;"
																pt:role="figure"
																pt:aria-label="#{item.fortschrittError}% #{msgs.statusError}">
																<h:outputText value="&#160;" />
																<f:passThroughAttribute
																	name="data-bs-trigger"
																	value="hover" />
																<f:passThroughAttribute
																	name="data-bs-container"
																	value="body" />
																<f:passThroughAttribute
																	name="data-bs-toggle"
																	value="popover" />
																<f:passThroughAttribute
																	name="data-bs-placement"
																	value="top" />
																<f:passThroughAttribute
																	name="data-bs-html"
																	value="true" />
																<f:passThroughAttribute
																	name="data-bs-content"
																	value="&lt;b class='font-status-error'&gt;#{msgs.statusError}:&lt;/b&gt;&lt;br/&gt; #{item.getStepsAsString(4, ', ')}" />
															</h:panelGroup>

															<h:panelGroup
																rendered="#{item.fortschritt1 gt 0}"
																data-toggle="tooltip"
																styleClass="progress-bar #{(LoginForm.myBenutzer.uiMode=='low_vision'?('easy-read-progressbar-status-locked'):('progress-bar-danger'))} "
																style="width: #{item.fortschritt1}%;line-height:15px;"
																pt:role="figure"
																pt:aria-label="#{item.fortschritt1}% #{msgs.statusGesperrt}">
																<h:outputText value="&#160;" />
																<f:passThroughAttribute
																	name="data-bs-trigger"
																	value="hover" />
																<f:passThroughAttribute
																	name="data-bs-container"
																	value="body" />
																<f:passThroughAttribute
																	name="data-bs-toggle"
																	value="popover" />
																<f:passThroughAttribute
																	name="data-bs-placement"
																	value="top" />
																<f:passThroughAttribute
																	name="data-bs-html"
																	value="true" />
																<f:passThroughAttribute
																	name="data-bs-content"
																	value="&lt;b class='font-status-locked'&gt;#{msgs.statusGesperrt}:&lt;/b&gt;&lt;br/&gt; #{item.getStepsAsString(0, ', ')}" />
															</h:panelGroup>
														</div>
													</td>
													<!-- // STATUS -->

													<!-- TITLE -->
													<td>
														<h:outputText
															value="#{item.projekt.titel}"
															styleClass=" #{item.getProjekt().projectIsArchived?'font-status-deactivated':'font-black'}" />
													</td>

													<!-- INSTITUTION -->
													<td
														jsf:rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['institution']}">
														<h:outputText
															value="#{item.projekt.institution.shortName}" />
													</td>

													<!-- LOCKINGS -->
													<td
														jsf:rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['lockings']}">
														<h:outputText
															value="#{item.benutzerGesperrt.nachVorname}"
															rendered="#{item.benutzerGesperrt != null}" />
													</td>

													<!-- LAST CHANGE DATE -->
													<td
														jsf:rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['editionDate']}">
														<h:outputText value="#{item.lastStatusChangeDate}" />
													</td>

													<!-- LAST CHANGE USER -->
													<td
														jsf:rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['editionUser']}">
														<h:outputText value="#{item.lastStatusChangeUser}" />
													</td>

													<!-- LAST CHANGE TASK -->
													<td
														jsf:rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['editionTask']}">
														<h:outputText value="#{item.lastStatusChangeTask}" />
													</td>

													<!-- SWAPPING -->
													<td
														jsf:rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['swappedOut']}">
														<i
															class="fa #{item.swappedOutGui?'fa-check-square-o':'fa-square-o'}" />
													</td>

													<!-- NUMBER OF IMAGES -->
													<td
														jsf:rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.anzeigeAnpassen['numberOfImages']}">
														<h:outputText value="#{item.sortHelperImages}" />
													</td>

													<!-- BUTTONS -->
													<td>

														<div class="gw-table__actions__container">

															<!-- EDIT PROCESS -->
															<button
																jsf:action="#{ProzessverwaltungForm.editProcess}"
																jsf:id="edit"
																aria-label="#{msgs.bearbeiten}"
																jsf:rendered="#{LoginForm.hasRole('Workflow_General_Details')}"
																jsf:rel="tooltip"
																onclick="preventDoubleSubmit(this);"
																title="#{ProzessverwaltungForm.modusAnzeige=='aktuell'?msgs.prozessBearbeiten:msgs.process_editTemplate}"
																data-bs-toggle="tooltip"
																class="btn btn-blank">
																<i class="fa fa-pencil" />
																<f:passThroughAttribute
																	name="data-toggle"
																	value="tooltip" />
																<x:updateActionListener
																	property="#{ProzessverwaltungForm.myProzess}"
																	value="#{item}" />
																<x:updateActionListener
																	property="#{ProzessverwaltungForm.modusBearbeiten}"
																	value="" />
															</button>

															<!-- CLONE PROCESS TEMPLATE -->
															<button
																class="btn btn-blank"
																aria-label="#{msgs.duplicate}"
																jsf:action="#{ProzessverwaltungForm.cloneProcess}"
																jsf:rel="tooltip"
																jsf:rendered="#{LoginForm.hasRole('Workflow_ProcessTemplates_Clone') and (ProzessverwaltungForm.modusAnzeige=='vorlagen')}"
																data-bs-toggle="tooltip"
																title="#{msgs.duplicate}"
																onclick="if (!confirm('#{msgs.wirklichAusfuehren}')) return false">
																<i class="fa fa-clipboard" />
																<f:passThroughAttribute
																	name="data-toggle"
																	value="tooltip" />
																<x:updateActionListener
																	property="#{ProzessverwaltungForm.myProzess}"
																	value="#{item}" />
															</button>

															<!-- METADATA EDITOR - READ ONLY -->
															<h:commandLink
																styleClass="btn btn-blank"
																action="#{Metadaten.XMLlesen}"
																id="action14"
																rel="tooltip"
																title="#{msgs.metadatenBearbeiten}"
																data-bs-toggle="tooltip"
																onclick="preventDoubleSubmit(this); sessionStorage.removeItem('columnWidths');"
																rendered="#{(!LoginForm.hasRole('Task_Mets_Pagination') and !LoginForm.hasRole('Task_Mets_Structure') and !LoginForm.hasRole('Task_Mets_Metadata') and !LoginForm.hasRole('Task_Mets_Files')) and item.benutzerGesperrt == null and ProzessverwaltungForm.modusAnzeige!='vorlagen'}">
																<i class="fa fa-book" />
																<f:passThroughAttribute
																	name="data-toggle"
																	value="tooltip" />
																<f:param
																	name="nurLesen"
																	value="true" />
																<f:param
																	name="ProzesseID"
																	value="#{item.id}" />
																<f:param
																	name="BenutzerID"
																	value="#{LoginForm.myBenutzer.id}" />
																<f:param
																	name="zurueck"
																	value="process_all" />
															</h:commandLink>

															<!-- METADATA EDITOR - INCL. WRITE -->
															<h:commandLink
																styleClass="btn btn-blank"
																action="#{Metadaten.XMLlesen}"
																id="action15"
																rel="tooltip"
																title="#{msgs.metadatenBearbeiten}"
																data-bs-toggle="tooltip"
																pt:aria-label="#{msgs.metadatenBearbeiten}"
																onclick="preventDoubleSubmit(this);  sessionStorage.removeItem('columnWidths');"
																rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and (LoginForm.hasRole('Task_Mets_Pagination') or LoginForm.hasRole('Task_Mets_Structure') or LoginForm.hasRole('Task_Mets_Metadata') or LoginForm.hasRole('Task_Mets_Files')) and !item.temporaryMetadataFiles}">
																<i class="fa fa-book" />
																<f:passThroughAttribute
																	name="data-toggle"
																	value="tooltip" />
																<f:param
																	name="ProzesseID"
																	value="#{item.id}" />
																<f:param
																	name="BenutzerID"
																	value="#{LoginForm.myBenutzer.id}" />
																<f:param
																	name="zurueck"
																	value="process_all" />
																<c:if test="#{LoginForm.hasRole('Task_Mets_Files')}">
																	<f:setPropertyActionListener
																		value="File"
																		target="#{Metadaten.modusAnsicht}" />
																</c:if>
																<c:if test="#{LoginForm.hasRole('Task_Mets_Metadata')}">
																	<f:setPropertyActionListener
																		value="Metadaten"
																		target="#{Metadaten.modusAnsicht}" />
																</c:if>
																<c:if test="#{LoginForm.hasRole('Task_Mets_Structure')}">
																	<f:setPropertyActionListener
																		value="Strukturdaten"
																		target="#{Metadaten.modusAnsicht}" />
																</c:if>
																<c:if
																	test="#{LoginForm.hasRole('Task_Mets_Pagination')}">
																	<f:setPropertyActionListener
																		value="Paginierung"
																		target="#{Metadaten.modusAnsicht}" />
																</c:if>
																<f:setPropertyActionListener
																	value="#{null}"
																	target="#{NavigationForm.uiStatus.mets_toc1}" />
																<f:setPropertyActionListener
																	value="#{null}"
																	target="#{NavigationForm.uiStatus.mets_toc2}" />
																<f:setPropertyActionListener
																	value="#{null}"
																	target="#{NavigationForm.uiStatus.mets_toc3}" />
																<f:setPropertyActionListener
																	value="#{null}"
																	target="#{NavigationForm.uiStatus.mets_toc4}" />
																<f:setPropertyActionListener
																	value="#{null}"
																	target="#{NavigationForm.uiStatus.mets_toc5}" />
															</h:commandLink>

															<!--  METADATA MODAL FOR TEMPORARY SAVED DATA  -->
															<h:panelGroup
																rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and (LoginForm.hasRole('Task_Mets_Pagination') or LoginForm.hasRole('Task_Mets_Structure') or LoginForm.hasRole('Task_Mets_Metadata') or LoginForm.hasRole('Task_Mets_Files')) and item.temporaryMetadataFiles}">
																<a
																	class="text_head"
																	rel="tooltip"
																	title="#{msgs.metadatenBearbeiten}"
																	data-bs-toggle="tooltip"
																	href="#"
																	data-toggle="modal"
																	data-target="#myModal-#{item.id}">
																	<i class="fa fa-book " />
																</a>
															</h:panelGroup>
															<div
																class="modal fade"
																id="myModal-#{item.id}"
																tabindex="-1"
																role="dialog"
																pt:aria-label="myModalLabel">
																<div
																	class="modal-dialog"
																	role="document">
																	<div class="modal-content">
																		<div class="modal-header">

																			<a
																				href="#"
																				class="btn btn-blue pull-right"
																				title="#{msgs.cancel}"
																				data-bs-toggle="tooltip"
																				data-dismiss="modal">
																				<i class="fa fa-times"></i>
																			</a>
																			<h4
																				class="modal-title"
																				id="#{msgs.metseditorOpen}-#{item.id}">
																				<h:outputText value="#{msgs.metseditorOpen}" />
																			</h4>
																		</div>
																		<div class="modal-body">
																			<h:outputText
																				value="#{msgs.metseditorTemporaryDataExplanation}" />
																		</div>
																		<div class="modal-footer">

																			<h:commandLink
																				onclick="sessionStorage.removeItem('columnWidths');"
																				action="#{Metadaten.XMLlesen}"
																				id="action15a"
																				data-bs-toggle="tooltip"
																				title="#{msgs.discard}"
																				rel="tooltip"
																				styleClass="btn btn-hot">
																				<i class="fa fa-trash-o margin-right-10"></i>
																				<h:outputText value="#{msgs.discard}" />
																				<f:passThroughAttribute
																					name="data-toggle"
																					value="tooltip" />
																				<f:param
																					name="ProzesseID"
																					value="#{item.id}" />
																				<f:param
																					name="BenutzerID"
																					value="#{LoginForm.myBenutzer.id}" />
																				<f:param
																					name="zurueck"
																					value="process_all" />
																				<f:param
																					name="discardChanges"
																					value="true" />
																				<f:setPropertyActionListener
																					value="#{null}"
																					target="#{NavigationForm.uiStatus.mets_toc1}" />
																				<f:setPropertyActionListener
																					value="#{null}"
																					target="#{NavigationForm.uiStatus.mets_toc2}" />
																				<f:setPropertyActionListener
																					value="#{null}"
																					target="#{NavigationForm.uiStatus.mets_toc3}" />
																				<f:setPropertyActionListener
																					value="#{null}"
																					target="#{NavigationForm.uiStatus.mets_toc4}" />
																				<f:setPropertyActionListener
																					value="#{null}"
																					target="#{NavigationForm.uiStatus.mets_toc5}" />
																			</h:commandLink>

																			<h:commandLink
																				onclick="sessionStorage.removeItem('columnWidths');"
																				action="#{Metadaten.XMLlesen}"
																				id="action15b"
																				title="#{msgs.overwrite}"
																				data-bs-toggle="tooltip"
																				rel="tooltip"
																				styleClass="btn btn-green">
																				<i class="fa fa-floppy-o"></i>
																				<h:outputText value="#{msgs.overwrite}" />
																				<f:passThroughAttribute
																					name="data-toggle"
																					value="tooltip" />
																				<f:param
																					name="ProzesseID"
																					value="#{item.id}" />
																				<f:param
																					name="BenutzerID"
																					value="#{LoginForm.myBenutzer.id}" />
																				<f:param
																					name="zurueck"
																					value="process_all" />
																				<f:param
																					name="overwriteChanges"
																					value="true" />
																				<f:setPropertyActionListener
																					value="#{null}"
																					target="#{NavigationForm.uiStatus.mets_toc1}" />
																				<f:setPropertyActionListener
																					value="#{null}"
																					target="#{NavigationForm.uiStatus.mets_toc2}" />
																				<f:setPropertyActionListener
																					value="#{null}"
																					target="#{NavigationForm.uiStatus.mets_toc3}" />
																				<f:setPropertyActionListener
																					value="#{null}"
																					target="#{NavigationForm.uiStatus.mets_toc4}" />
																				<f:setPropertyActionListener
																					value="#{null}"
																					target="#{NavigationForm.uiStatus.mets_toc5}" />
																			</h:commandLink>
																		</div>
																	</div>
																</div>
															</div>

															<!-- DMS-EXPORT - ENABLED -->
															<div
																jsf:rel="tooltip"
																title="#{!item.containsExportStep ? msgs.noExportTask : ''}"
																data-bs-toggle="tooltip">
																<button
																	jsf:action="#{ProzessverwaltungForm.ExportDMS}"
																	jsf:id="action21"
																	aria-label="#{!item.containsExportStep ? msgs.noExportTask : msgs.importDms}"
																	jsf:rel="tooltip"
																	onclick="preventDoubleSubmit(this);"
																	title="#{msgs.importDms}"
																	data-bs-toggle="tooltip"
																	class="btn btn-blank"
																	jsf:disabled="#{!item.containsExportStep}"
																	jsf:rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and LoginForm.hasRole('Workflow_Processes_Allow_Export') and item.displayDMSButton}">
																	<i class="fa fa-globe" />
																	<f:passThroughAttribute
																		name="data-toggle"
																		value="tooltip" />
																	<x:updateActionListener
																		property="#{ProzessverwaltungForm.myProzess}"
																		value="#{item}" />
																</button>
																<f:passThroughAttribute
																	name="data-toggle"
																	value="tooltip" />
															</div>

															<!-- DMS-EXPORT - DISABLED -->
															<button
																jsf:action="#{ProzessverwaltungForm.ExportDMS}"
																jsf:disabled="true"
																jsf:rel="tooltip"
																title="#{msgs.importDms}"
																data-bs-toggle="tooltip"
																jsf:rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and LoginForm.hasRole('Workflow_Processes_Allow_Export') and !item.displayDMSButton}"
																class="btn btn-blank">
																<i class="font-light fa fa-globe" />
																<f:passThroughAttribute
																	name="data-toggle"
																	value="tooltip" />
																<x:updateActionListener
																	property="#{ProzessverwaltungForm.myProzess}"
																	value="#{item}" />
															</button>

															<!-- CREATE PROCESS - ONE PROJECT -->
															<button
																class="btn fa fa-file-o #{!ProzesskopieForm.isUserInProcessProject(item) or item.getProjekt().projectIsArchived?'disabled':''} #{item.containsUnreachableSteps?'btn-hot':'btn-primary-400'} button-schaltknopf"
																jsf:action="#{ProzesskopieForm.Prepare}"
																jsf:id="action22"
																jsf:rel="tooltip"
																onclick="preventDoubleSubmit(this);"
																data-bs-toggle="tooltip"
																title="#{item.containsUnreachableSteps?msgs.prozessvorlageMitUnvollstaendigenSchrittdetails:
					                                              (item.getProjekt().projectIsArchived ? msgs.projectIsArchived :
					                                              (ProzesskopieForm.isUserInProcessProject(item) ? msgs.eineKopieDieserProzessvorlageAnlegen : msgs.nutzerNichtFuerProjektZugeordnet)
					                                              )
					                                              }"
																jsf:rendered="#{ProzessverwaltungForm.modusAnzeige=='vorlagen' and LoginForm.hasRole('Workflow_ProcessTemplates_Import_Single') and ProzesskopieForm.availableProjects.size() eq 1}">
																<f:passThroughAttribute
																	name="data-toggle"
																	value="tooltip" />
																<x:updateActionListener
																	property="#{ProzesskopieForm.prozessVorlage}"
																	value="#{item}" />
															</button>

															<!-- CREATE PROCESS - MULTIPLE PROJECTS -->
															<h:panelGroup
																rendered="#{ProzessverwaltungForm.modusAnzeige=='vorlagen' and LoginForm.hasRole('Workflow_ProcessTemplates_Import_Single') and ProzesskopieForm.availableProjects.size() gt 1}">

																<div
																	data-bs-toggle="tooltip"
																	title="#{item.containsUnreachableSteps?msgs.prozessvorlageMitUnvollstaendigenSchrittdetails:
						                                              (item.getProjekt().projectIsArchived ? msgs.projectIsArchived :
						                                              (ProzesskopieForm.isUserInProcessProject(item) ? msgs.eineKopieDieserProzessvorlageAnlegen : msgs.nutzerNichtFuerProjektZugeordnet)
						                                              )
						                                              }">

																	<div class="btn-group position-static">
																		<button
																			jsf:id="copyProcessTempalte"
																			class="btn fa fa-file-o #{!ProzesskopieForm.isUserInProcessProject(item) or item.getProjekt().projectIsArchived?'disabled':''} #{item.containsUnreachableSteps?'btn-hot':'btn-primary-400'}"
																			aria-label="#{msgs.eineKopieDieserProzessvorlageAnlegen}"
																			jsf:action="#{ProzesskopieForm.Prepare}"
																			jsf:rel="tooltip">
																			<f:passThroughAttribute
																				name="data-toggle"
																				value="tooltip" />
																			<x:updateActionListener
																				property="#{ProzesskopieForm.prozessVorlage}"
																				value="#{item}" />
																		</button>

																		<button
																			type="button"
																			class="btn #{item.containsUnreachableSteps or item.getProjekt().projectIsArchived?'btn-hot':'btn-primary-400'} dropdown-toggle dropdown-toggle-split"
																			data-bs-toggle="dropdown"
																			aria-expanded="false">
																			<span class="visually-hidden">Toggle Dropdown</span>
																		</button>
																		<ul class="dropdown-menu">
																			<ui:repeat
																				var="proj"
																				value="#{ProzesskopieForm.availableProjects}">
																				<li>
																					<button
																						jsf:id="prepare"
																						jsf:action="#{ProzesskopieForm.Prepare}"
																						class="dropdown-item">
																						<h:outputText value="#{proj.titel}" />
																						<x:updateActionListener
																							property="#{item.projekt}"
																							value="#{proj}" />
																						<x:updateActionListener
																							property="#{ProzesskopieForm.prozessVorlage}"
																							value="#{item}" />
																					</button>
																				</li>
																			</ui:repeat>
																		</ul>
																	</div>

																</div>
															</h:panelGroup>

															<!-- MASS IMPORT - ONE PROJECT -->
															<button
																class="btn fa fa-files-o #{!ProzesskopieForm.isUserInProcessProject(item) or item.getProjekt().projectIsArchived?'disabled':''} #{item.containsUnreachableSteps?'btn-hot':'btn-primary-400'} button-schaltknopf"
																jsf:action="#{MassImportForm.Prepare}"
																jsf:id="action222"
																jsf:rel="tooltip"
																data-bs-toggle="tooltip"
																title="#{item.containsUnreachableSteps?msgs.prozessvorlageMitUnvollstaendigenSchrittdetails:
		                                                        (item.getProjekt().projectIsArchived ? msgs.projectIsArchived :
		                                                        (ProzesskopieForm.isUserInProcessProject(item) ? msgs.MassenImport : msgs.nutzerNichtFuerProjektZugeordnet)
		                                                        )
		                                                        }"
																onclick="preventDoubleSubmit(this);"
																jsf:rendered="#{(ProzessverwaltungForm.modusAnzeige=='vorlagen' and HelperForm.massImportAllowed and LoginForm.hasRole('Workflow_ProcessTemplates_Import_Multi') and ProzesskopieForm.availableProjects.size() eq 1)}">
																<f:passThroughAttribute
																	name="data-toggle"
																	value="tooltip" />
																<x:updateActionListener
																	property="#{MassImportForm.template}"
																	value="#{item}" />
															</button>

															<!-- MASS IMPORT - MULTIPLE PROJECTS -->
															<h:panelGroup
																rendered="#{(ProzessverwaltungForm.modusAnzeige=='vorlagen' and HelperForm.massImportAllowed and LoginForm.hasRole('Workflow_ProcessTemplates_Import_Multi') and ProzesskopieForm.availableProjects.size() gt 1)}">
																<div
																	class="dropdown-left"
																	data-bs-toggle="tooltip"
																	title="#{item.containsUnreachableSteps?msgs.prozessvorlageMitUnvollstaendigenSchrittdetails:
			                                                        (item.getProjekt().projectIsArchived ? msgs.projectIsArchived :
			                                                        (ProzesskopieForm.isUserInProcessProject(item) ? msgs.MassenImport : msgs.nutzerNichtFuerProjektZugeordnet)
			                                                        )
			                                                        }">

																	<div class="btn-group position-static">
																		<button
																			jsf:id="massImportPrepare"
																			class="btn fa fa-files-o #{!ProzesskopieForm.isUserInProcessProject(item) or item.getProjekt().projectIsArchived?'disabled':''} #{item.containsUnreachableSteps?'btn-hot':'btn-primary-400'}"
																			aria-label="#{msgs.eineKopieDieserProzessvorlageAnlegen}"
																			jsf:action="#{MassImportForm.Prepare}"
																			jsf:rel="tooltip">
																			<f:passThroughAttribute
																				name="data-toggle"
																				value="tooltip" />
																			<x:updateActionListener
																				property="#{MassImportForm.template}"
																				value="#{item}" />
																		</button>

																		<button
																			type="button"
																			class="btn #{item.containsUnreachableSteps or item.getProjekt().projectIsArchived?'btn-hot':'btn-primary-400'} dropdown-toggle dropdown-toggle-split"
																			data-bs-toggle="dropdown"
																			aria-expanded="false">
																			<span class="visually-hidden">Toggle Dropdown</span>
																		</button>
																		<ul class="dropdown-menu">
																			<ui:repeat
																				var="proj"
																				value="#{ProzesskopieForm.availableProjects}">
																				<li>
																					<button
																						jsf:action="#{MassImportForm.Prepare}"
																						jsf:id="prepare"
																						class="dropdown-item">
																						<h:outputText value="#{proj.titel}" />
																						<x:updateActionListener
																							property="#{item.projekt}"
																							value="#{proj}" />
																						<x:updateActionListener
																							property="#{item.projectId}"
																							value="#{proj.id}" />
																						<x:updateActionListener
																							property="#{MassImportForm.template}"
																							value="#{item}" />
																					</button>
																				</li>
																			</ui:repeat>
																		</ul>
																	</div>
																</div>
															</h:panelGroup>

															<!-- ADDITIONAL OPTIONS AS DROPDOWN -->
															<h:panelGroup
																rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and (LoginForm.hasRole('Workflow_Processes_Allow_Download') or LoginForm.hasRole('Workflow_Processes_Allow_Linking'))}">
																<div
																	class="dropdown-left"
																	title="#{msgs.additionalOptions}"
																	data-bs-toggle="tooltip">
																	<button
																		jsf:id="additionalOptionsDropdown"
																		aria-label="#{msgs.additionalOptions}"
																		aria-haspopup="true"
																		aria-expanded="false"
																		onclick="switchExpanded(this.id)"
																		type="button"
																		class="btn btn-blank dropdown-toggle"
																		data-bs-toggle="dropdown">
																		<i class="fa fa-cog" />
																	</button>
																	<ul class="dropdown-menu">

																		<h:panelGroup
																			rendered="#{LoginForm.hasRole('Workflow_Processes_Allow_Linking')}">
																			<li>
																				<!-- DOWNLOAD INTO HOME DIRECTORY -->
																				<button
																					jsf:action="#{ProzessverwaltungForm.DownloadToHome}"
																					jsf:id="action16"
																					jsf:rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and !item.imageFolderInUse}"
																					class="dropdown-item">
																					<i class="fa fa-cloud-download" />
																					<span>
																						<h:outputText
																							value="#{msgs.imHomeVerzeichnisVerlinken}" />
																					</span>
																					<x:updateActionListener
																						property="#{ProzessverwaltungForm.myProzess}"
																						value="#{item}" />
																				</button>
																			</li>
																			<li>
																				<!-- DOWNLOAD INTO HOME DIRECTORY - FOR ADMINS -->
																				<button
																					jsf:action="#{ProzessverwaltungForm.DownloadToHome}"
																					jsf:id="action17"
																					onclick="if (!confirm('#{msgs.warningAdminBeforeLinking}')) return false"
																					jsf:rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and item.imageFolderInUse}"
																					class="dropdown-item">
																					<i class="fa fa-cloud-download" />
																					<span>
																						<h:outputText
																							value="#{msgs.imHomeVerzeichnisVerlinkenTrotzBearbeitung}" />
																					</span>
																					<x:updateActionListener
																						property="#{ProzessverwaltungForm.myProzess}"
																						value="#{item}" />
																				</button>
																			</li>
																			<li>
																				<!-- UPLOAD FROM HOME DIRECTORY -->
																				<button
																					jsf:action="#{ProzessverwaltungForm.UploadFromHome}"
																					jsf:id="action18"
																					onclick="if (!confirm('#{msgs.ausHomeverzeichnisEntfernen}')) return false"
																					jsf:rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen'}"
																					class="dropdown-item">
																					<i class="fa fa-cloud-upload" />
																					<span>
																						<h:outputText
																							value="#{msgs.ausHomeverzeichnisEntfernen}" />
																					</span>
																					<x:updateActionListener
																						property="#{ProzessverwaltungForm.myProzess}"
																						value="#{item}" />
																				</button>
																			</li>
																		</h:panelGroup>

																		<h:panelGroup
																			rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and LoginForm.hasRole('Workflow_Processes_Allow_Download')}">
																			<li>
																				<!-- DOWNLOAD LOG FILE -->
																				<button
																					jsf:id="ubid119"
																					jsf:action="#{item.downloadLogFile}"
																					onclick="preventDoubleSubmit(this);"
																					class="dropdown-item">
																					<i class="fa fa-file-code-o" />
																					<span>
																						<h:outputText value="#{msgs.downloadLogFile}" />
																					</span>
																				</button>
																			</li>
																			<li>
																				<!-- DOWNLOAD DOCKET -->
																				<button
																					jsf:id="ubid1119"
																					jsf:action="#{item.downloadDocket}"
																					onclick="preventDoubleSubmit(this);"
																					class="dropdown-item">
																					<i class="fa fa-print" />
																					<span>
																						<h:outputText
																							value="#{msgs.process_generateDocket}" />
																					</span>
																				</button>

																			</li>
																			<li>
																				<!-- DOWNLOAD METS FILE -->
																				<button
																					jsf:action="#{ProzessverwaltungForm.downloadMets}"
																					jsf:id="action25"
																					onclick="preventDoubleSubmit(this);"
																					jsf:rendered="#{item.displayMETSButton}"
																					class="dropdown-item">
																					<i class="fa fa-floppy-o" />
																					<span>
																						<h:outputText value="#{msgs.downloadMets}" />
																					</span>
																					<x:updateActionListener
																						property="#{ProzessverwaltungForm.myProzess}"
																						value="#{item}" />
																				</button>
																			</li>
																			<li>
																				<!-- DOWNLOAD PDF FILE -->
																				<button
																					jsf:action="#{ProzessverwaltungForm.ExportPdf}"
																					jsf:id="action20"
																					onclick="preventDoubleSubmit(this);"
																					jsf:rendered="#{item.displayPDFButton}"
																					class="dropdown-item">
																					<i class="fa fa-file-pdf-o" />
																					<span>
																						<h:outputText
																							value="#{msgs.process_generatePdfForEntireObject}" />
																					</span>
																					<x:updateActionListener
																						property="#{ProzessverwaltungForm.myProzess}"
																						value="#{item}" />
																				</button>
																			</li>

																			<li>
																				<!-- GENERATE SIMPLIFIED METADATA -->
																				<button
																					jsf:action="#{ProzessverwaltungForm.generateSimplifiedMetadataFile}"
																					jsf:id="action23"
																					onclick="preventDoubleSubmit(this);"
																					class="dropdown-item">
																					<i class="fa fa-file-pdf-o" />
																					<span>
																						<h:outputText
																							value="#{msgs.process_generateSimplifiedMetadata}" />
																					</span>
																					<x:updateActionListener
																						property="#{ProzessverwaltungForm.myProzess}"
																						value="#{item}" />
																				</button>
																			</li>

																		</h:panelGroup>

																	</ul>
																</div>
															</h:panelGroup>
														</div>
													</td>
												</tr>
											</ui:repeat>
										</table>
									</div>
									<!--/.gw-table__filters-->

									<div class="box__actions">
										<button
											jsf:action="#{ProzessverwaltungForm.NeuVorlage}"
											jsf:immediate="true"
											class="btn btn-primary-400 me-auto"
											jsf:rendered="#{LoginForm.hasRole('Workflow_General_Details_Edit') and LoginForm.hasRole('Workflow_ProcessTemplates_Create') and ProzessverwaltungForm.modusAnzeige=='vorlagen'}"
											jsf:id="new2">
											<i class="fa fa-plus"></i>
											<span>
												<h:outputText value="#{msgs.eineNeueProzessvorlageAnlegen}" />
											</span>
										</button>

										<!-- paginator -->
										<div class="dataTables__paginate">
											<intranda:tablePaginator
												paginator="#{ProzessverwaltungForm.paginator}"
												id="navigator" />
										</div>
									</div>
								</h:form>

							</div>
						</intranda:box>

					</div>
				</div>

				<h:panelGroup
					rendered="#{ProzessverwaltungForm.modusAnzeige!='vorlagen' and ProzessverwaltungForm.paginator.list.size() gt 0}">
					<!-- ACTION AREA -->
					<ui:include src="templatePG/includes/process/list_action.xhtml" />
					<!-- COUNTING AREA -->
					<ui:include src="templatePG/includes/process/list_count.xhtml" />
					<!-- STATISTICS AREA -->
					<ui:include src="templatePG/includes/process/list_statistics.xhtml" />
				</h:panelGroup>

			</c:if>

			<!-- JAVASCRIPT -->
			<script type="text/javascript">
		        function showGoobiScriptModal({data, modalID = undefined} = {}) {
		            // console.log(1)
		            // console.log(modalID)
		          if (!modalID) return
		            if (data.status !== "success") return
		          const mdl = new bootstrap.Modal(document.getElementById(modalID));
		          mdl.show()
		        }

				window.onload = function() {
					loadImages();
					// load codemirror for some syntax highlighting
					// initGoobiScriptCodeMirror();
				}

	        	var goobiScriptCodeMirror;
			    function handleGoobiScriptCodeEditor() {
			        removeGoobiScriptCodeMirror();
			        initGoobiScriptCodeMirror();
			    }
	
	            function removeGoobiScriptCodeMirror() {
	                var codeEditors = document.querySelectorAll('.CodeMirror');
	                codeEditors.forEach(function(editor) { editor.remove() })
	            }
	
	            function initGoobiScriptCodeMirror() {
	            	var goobiScriptTextArea = document.getElementById("goobiScriptfield");
	            	if(goobiScriptTextArea) {
	                	goobiScriptCodeMirror = CodeMirror.fromTextArea(goobiScriptTextArea, {
							lineNumbers: true,
							mode: 'yaml'
						});
	                	goobiScriptCodeMirror.on('change', editor => {
							document.getElementById("goobiScriptfield").innerHTML = editor.getValue();
					    });
	            	}
	            }
	
	            jsf.ajax.addOnEvent( function( data ) {
	                var ajaxstatus = data.status;
	                switch ( ajaxstatus ) {
	                    case "success":
	                    	if(data.source.id == "boxProcessesAllActions:expandbutton5") {
	                    		initGoobiScriptCodeMirror();
	                    	}
	                        break;
	                }
	            });
            
			</script>
			<!-- // JAVASCRIPT -->

		</main>
	</ui:define>

</ui:composition>
